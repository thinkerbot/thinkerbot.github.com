<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Gitgo::Git::Tree</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Gitgo::Git::Tree</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../../files/lib/gitgo/git/tree_rb.html">
                lib/gitgo/git/tree.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
<a href="Tree.html">Tree</a> represents an in-memory working tree for git.
Trees are initialized with a Grit::Tree. In general tree contents are
represented as (path, [:mode,<a href="Tree.html#M000248">sha</a>]) pairs,
but subtrees can be expanded into (path, <a href="Tree.html">Tree</a>)
pairs.
</p>
<p>
See <a href="../Git.html">Git</a> for an example of <a
href="Tree.html">Tree</a> usage in practice.
</p>
<h3>Efficiency</h3>
<p>
Modes are symbolized in the internal [:mode,<a
href="Tree.html#M000248">sha</a>] entries because they are rarely needed as
strings and are typically very redundant. Symbolizing shas makes less sense
because they are frequently used as strings. However it does make sense to
use the same string instance to represent a <a
href="Tree.html#M000248">sha</a> in multiple places. As a result trees have
an internal <a href="Tree.html#M000244">string_table</a> that functions
like a symbol table, ie it maps the same string content to a single shared
instance. The string table is managed at the class level through the <a
href="Tree.html#M000244">string_table</a> method.
</p>
<p>
Trees only expand as needed. This saves memory and cycles because it is
expensive to read, parse, and maintain the git tree data. In general trees
will stay fairly compact unless certain expensive operations are performed.
These are:
</p>
<ul>
<li><a href="Tree.html#M000254">each_pair</a> (with expand == true)

</li>
<li><a href="Tree.html#M000256">each_tree</a> (with expand == true)

</li>
<li><a href="Tree.html#M000258">flatten</a>

</li>
<li><a href="Tree.html#M000259">to_hash</a> (with expand == true)

</li>
</ul>
<p>
Avoid these methods if possible, or ensure they are rarely executed.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000261">==</a>&nbsp;&nbsp;
      <a href="#M000250">[]</a>&nbsp;&nbsp;
      <a href="#M000251">[]=</a>&nbsp;&nbsp;
      <a href="#M000253">each</a>&nbsp;&nbsp;
      <a href="#M000255">each_blob</a>&nbsp;&nbsp;
      <a href="#M000254">each_pair</a>&nbsp;&nbsp;
      <a href="#M000256">each_tree</a>&nbsp;&nbsp;
      <a href="#M000260">eql?</a>&nbsp;&nbsp;
      <a href="#M000258">flatten</a>&nbsp;&nbsp;
      <a href="#M000249">keys</a>&nbsp;&nbsp;
      <a href="#M000252">merge!</a>&nbsp;&nbsp;
      <a href="#M000246">mode=</a>&nbsp;&nbsp;
      <a href="#M000245">new</a>&nbsp;&nbsp;
      <a href="#M000248">sha</a>&nbsp;&nbsp;
      <a href="#M000247">sha=</a>&nbsp;&nbsp;
      <a href="#M000244">string_table</a>&nbsp;&nbsp;
      <a href="#M000257">subtree</a>&nbsp;&nbsp;
      <a href="#M000259">to_hash</a>&nbsp;&nbsp;
      <a href="#M000262">write_to</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->
    <div id="includes">
      <h3 class="section-bar">Included Modules</h3>

      <div id="includes-list">
        <span class="include-name">Enumerable</span>
      </div>
    </div>

    <div id="section">





    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">mode</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
The tree mode.

</td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000245" class="method-detail">
        <a name="M000245"></a>

        <div class="method-heading">
          <a href="#M000245" class="method-signature">
          <span class="method-name">new</span><span class="method-args">(tree=nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Initializes a <a href="Tree.html#M000245">new</a> <a
href="Tree.html">Tree</a>. The input tree should be a Grit::Tree or nil.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000245-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000245-source">
<pre>
    <span class="ruby-comment cmt"># File lib/gitgo/git/tree.rb, line 49</span>
49:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">tree</span>=<span class="ruby-keyword kw">nil</span>)
50:         <span class="ruby-ivar">@index</span> = <span class="ruby-keyword kw">nil</span>
51:         <span class="ruby-ivar">@tree</span> = <span class="ruby-identifier">tree</span>
52:         
53:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tree</span>
54:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">mode</span> = <span class="ruby-identifier">tree</span>.<span class="ruby-identifier">mode</span>
55:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">sha</span>  = <span class="ruby-identifier">tree</span>.<span class="ruby-identifier">id</span>
56:         <span class="ruby-keyword kw">else</span>
57:           <span class="ruby-ivar">@mode</span> = <span class="ruby-keyword kw">nil</span>
58:           <span class="ruby-ivar">@sha</span> = <span class="ruby-keyword kw">nil</span>
59:         <span class="ruby-keyword kw">end</span>
60:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000244" class="method-detail">
        <a name="M000244"></a>

        <div class="method-heading">
          <a href="#M000244" class="method-signature">
          <span class="method-name">string_table</span><span class="method-args">(clear=false)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the string table for shas. Specify clear to reset the string table.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000244-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000244-source">
<pre>
    <span class="ruby-comment cmt"># File lib/gitgo/git/tree.rb, line 38</span>
38:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">string_table</span>(<span class="ruby-identifier">clear</span>=<span class="ruby-keyword kw">false</span>)
39:           <span class="ruby-ivar">@string_table</span>.<span class="ruby-identifier">clear</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">clear</span>
40:           <span class="ruby-ivar">@string_table</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">hash</span>, <span class="ruby-identifier">key</span><span class="ruby-operator">|</span> <span class="ruby-identifier">hash</span>[<span class="ruby-identifier">key</span>] = <span class="ruby-identifier">key</span>.<span class="ruby-identifier">freeze</span> }
41:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000261" class="method-detail">
        <a name="M000261"></a>

        <div class="method-heading">
          <a href="#M000261" class="method-signature">
          <span class="method-name">==</span><span class="method-args">(another)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns true if the <a href="Tree.html#M000259">to_hash</a> results of self
and another are equal.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000261-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000261-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/git/tree.rb, line 239</span>
239:       <span class="ruby-keyword kw">def</span> <span class="ruby-operator">==</span>(<span class="ruby-identifier">another</span>)
240:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">to_hash</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">another</span>.<span class="ruby-identifier">to_hash</span>
241:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000250" class="method-detail">
        <a name="M000250"></a>

        <div class="method-heading">
          <a href="#M000250" class="method-signature">
          <span class="method-name">[]</span><span class="method-args">(path)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the entry for the specified path, either a [:mode,<a
href="Tree.html#M000248">sha</a>] pair for a blob or a <a
href="Tree.html">Tree</a> for a <a href="Tree.html#M000257">subtree</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000250-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000250-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/git/tree.rb, line 102</span>
102:       <span class="ruby-keyword kw">def</span> <span class="ruby-operator">[]</span>(<span class="ruby-identifier">path</span>)
103:         <span class="ruby-keyword kw">case</span>
104:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">entry</span> = <span class="ruby-identifier">index</span>[<span class="ruby-identifier">path</span>]
105:           <span class="ruby-identifier">entry</span>
106:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">tree</span> = <span class="ruby-identifier">index</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">path</span>.<span class="ruby-identifier">to_sym</span>)
107:           <span class="ruby-identifier">index</span>[<span class="ruby-identifier">string</span>(<span class="ruby-identifier">path</span>)] = <span class="ruby-constant">Tree</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">tree</span>)
108:         <span class="ruby-keyword kw">else</span>
109:           <span class="ruby-keyword kw">nil</span>
110:         <span class="ruby-keyword kw">end</span>
111:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000251" class="method-detail">
        <a name="M000251"></a>

        <div class="method-heading">
          <a href="#M000251" class="method-signature">
          <span class="method-name">[]=</span><span class="method-args">(path, entry)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets the entry for the specified path. The entry should be a
</p>
<dl>
<dt>:mode,<a href="Tree.html#M000248">sha</a></dt><dd>array, or a <a href="Tree.html">Tree</a>. A nil entry indicates removal.

</dd>
</dl>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000251-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000251-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/git/tree.rb, line 115</span>
115:       <span class="ruby-keyword kw">def</span> <span class="ruby-operator">[]=</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">entry</span>)
116:         <span class="ruby-comment cmt"># ensure an unexpanded tree is removed</span>
117:         <span class="ruby-identifier">index</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">path</span>.<span class="ruby-identifier">to_sym</span>)
118:         
119:         <span class="ruby-identifier">path</span> = <span class="ruby-identifier">string</span>(<span class="ruby-identifier">path</span>)
120:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">entry</span>
121:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Array</span>
122:           <span class="ruby-identifier">mode</span>, <span class="ruby-identifier">sha</span> = <span class="ruby-identifier">entry</span>
123:           <span class="ruby-identifier">index</span>[<span class="ruby-identifier">path</span>] = [<span class="ruby-identifier">mode</span>.<span class="ruby-identifier">to_sym</span>, <span class="ruby-identifier">string</span>(<span class="ruby-identifier">sha</span>)]
124:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Tree</span>
125:           <span class="ruby-identifier">index</span>[<span class="ruby-identifier">path</span>] = <span class="ruby-identifier">entry</span>
126:         <span class="ruby-keyword kw">when</span> <span class="ruby-keyword kw">nil</span>
127:           <span class="ruby-identifier">index</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">path</span>)
128:         <span class="ruby-keyword kw">else</span>
129:           <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;invalid entry: #{entry.inspect}&quot;</span>
130:         <span class="ruby-keyword kw">end</span>
131:         
132:         <span class="ruby-comment cmt"># add/remove content modifies self so</span>
133:         <span class="ruby-comment cmt"># the sha can and should be invalidated</span>
134:         <span class="ruby-ivar">@sha</span> = <span class="ruby-keyword kw">nil</span>
135:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000253" class="method-detail">
        <a name="M000253"></a>

        <div class="method-heading">
          <a href="#M000253" class="method-signature">
          <span class="method-name">each</span><span class="method-args">() {|[key, value]| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Yields <a href="Tree.html#M000253">each</a> (path, entry) pair to the
block, as an array, ordered by path. Implemented to get access to the
enumerable methods.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000253-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000253-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/git/tree.rb, line 146</span>
146:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each</span>
147:         <span class="ruby-identifier">each_pair</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
148:           <span class="ruby-keyword kw">yield</span> [<span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span>]
149:         <span class="ruby-keyword kw">end</span>
150:         <span class="ruby-keyword kw">self</span>
151:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000255" class="method-detail">
        <a name="M000255"></a>

        <div class="method-heading">
          <a href="#M000255" class="method-signature">
          <span class="method-name">each_blob</span><span class="method-args">() {|key, value| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Yields the (path, [:mode, <a href="Tree.html#M000248">sha</a>]) pairs for
<a href="Tree.html#M000253">each</a> blob to the block.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000255-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000255-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/git/tree.rb, line 168</span>
168:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each_blob</span>
169:         <span class="ruby-identifier">each_pair</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
170:           <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Array</span>)
171:           <span class="ruby-keyword kw">yield</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span>)
172:         <span class="ruby-keyword kw">end</span>
173:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000254" class="method-detail">
        <a name="M000254"></a>

        <div class="method-heading">
          <a href="#M000254" class="method-signature">
          <span class="method-name">each_pair</span><span class="method-args">(expand=false) {|key, store[key]| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Yields <a href="Tree.html#M000253">each</a> (path, entry) pair to the
block, ordered by path. Entries can be [:mode,<a
href="Tree.html#M000248">sha</a>] arrays or Trees. If expand is true then
subtrees will be expanded, but strongly consider whether or not expansion
is necessary because it is computationally expensive.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000254-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000254-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/git/tree.rb, line 157</span>
157:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each_pair</span>(<span class="ruby-identifier">expand</span>=<span class="ruby-keyword kw">false</span>)
158:         
159:         <span class="ruby-comment cmt"># sorting the keys is important when writing the tree;</span>
160:         <span class="ruby-comment cmt"># unsorted keys cause warnings in git fsck</span>
161:         <span class="ruby-identifier">keys</span> = <span class="ruby-identifier">index</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">sort_by</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">to_s</span> }
162:         <span class="ruby-identifier">store</span> = <span class="ruby-identifier">expand</span> <span class="ruby-value">? </span><span class="ruby-keyword kw">self</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">index</span>
163:         
164:         <span class="ruby-identifier">keys</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span> <span class="ruby-keyword kw">yield</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">store</span>[<span class="ruby-identifier">key</span>]) }
165:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000256" class="method-detail">
        <a name="M000256"></a>

        <div class="method-heading">
          <a href="#M000256" class="method-signature">
          <span class="method-name">each_tree</span><span class="method-args">(expand=false) {|key, value| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Yields the (path, entry) pairs for <a href="Tree.html#M000253">each</a>
tree to the block. Subtrees are expanded if specified, in which case all
entries will be Trees. Without expansion, entries may be [:mode,<a
href="Tree.html#M000248">sha</a>] arrays or Trees.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000256-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000256-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/git/tree.rb, line 178</span>
178:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each_tree</span>(<span class="ruby-identifier">expand</span>=<span class="ruby-keyword kw">false</span>)
179:         <span class="ruby-identifier">each_pair</span>(<span class="ruby-identifier">expand</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
180:           <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Tree</span>)
181:           <span class="ruby-keyword kw">yield</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span>)
182:         <span class="ruby-keyword kw">end</span>
183:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000260" class="method-detail">
        <a name="M000260"></a>

        <div class="method-heading">
          <a href="#M000260" class="method-signature">
          <span class="method-name">eql?</span><span class="method-args">(another)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns true if the <a href="Tree.html#M000259">to_hash</a> results of self
and another are equal.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000260-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000260-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/git/tree.rb, line 234</span>
234:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">eql?</span>(<span class="ruby-identifier">another</span>)
235:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">to_hash</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">another</span>.<span class="ruby-identifier">to_hash</span>
236:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000258" class="method-detail">
        <a name="M000258"></a>

        <div class="method-heading">
          <a href="#M000258" class="method-signature">
          <span class="method-name">flatten</span><span class="method-args">(prefix=nil, target={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Flattens all paths under self into a single array.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000258-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000258-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/git/tree.rb, line 203</span>
203:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">flatten</span>(<span class="ruby-identifier">prefix</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">target</span>={})
204:         <span class="ruby-identifier">keys</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span>
205:           <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">entry</span> = <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">key</span>]
206: 
207:           <span class="ruby-identifier">key</span> = <span class="ruby-identifier">key</span>.<span class="ruby-identifier">to_s</span>
208:           <span class="ruby-identifier">key</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">prefix</span>, <span class="ruby-identifier">key</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">prefix</span>
209: 
210:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Tree</span>)
211:             <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">flatten</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">target</span>)
212:           <span class="ruby-keyword kw">else</span>
213:             <span class="ruby-identifier">target</span>[<span class="ruby-identifier">key</span>] = <span class="ruby-identifier">entry</span>
214:           <span class="ruby-keyword kw">end</span>
215:         <span class="ruby-keyword kw">end</span>
216: 
217:         <span class="ruby-identifier">target</span>
218:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000249" class="method-detail">
        <a name="M000249"></a>

        <div class="method-heading">
          <a href="#M000249" class="method-signature">
          <span class="method-name">keys</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the <a href="Tree.html#M000249">keys</a> (ie paths) for all entries
in self. Keys are returned as strings
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000249-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000249-source">
<pre>
    <span class="ruby-comment cmt"># File lib/gitgo/git/tree.rb, line 96</span>
96:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">keys</span>
97:         <span class="ruby-identifier">index</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">collect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">keys</span><span class="ruby-operator">|</span> <span class="ruby-identifier">keys</span>.<span class="ruby-identifier">to_s</span> }
98:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000252" class="method-detail">
        <a name="M000252"></a>

        <div class="method-heading">
          <a href="#M000252" class="method-signature">
          <span class="method-name">merge!</span><span class="method-args">(another)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000252-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000252-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/git/tree.rb, line 137</span>
137:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">another</span>)
138:         <span class="ruby-identifier">another</span>.<span class="ruby-identifier">each_pair</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">path</span>, <span class="ruby-identifier">entry</span><span class="ruby-operator">|</span>
139:           <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">path</span>] = <span class="ruby-identifier">entry</span>
140:         <span class="ruby-keyword kw">end</span>
141:         <span class="ruby-keyword kw">self</span>
142:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000246" class="method-detail">
        <a name="M000246"></a>

        <div class="method-heading">
          <a href="#M000246" class="method-signature">
          <span class="method-name">mode=</span><span class="method-args">(mode)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets mode, symbolizing if necessary. Mode may be set to nil in which case
the git.default_tree_mode is adopted when the tree is written.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000246-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000246-source">
<pre>
    <span class="ruby-comment cmt"># File lib/gitgo/git/tree.rb, line 64</span>
64:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">mode=</span>(<span class="ruby-identifier">mode</span>)
65:         <span class="ruby-ivar">@mode</span> = <span class="ruby-identifier">mode</span> <span class="ruby-value">? </span><span class="ruby-identifier">mode</span>.<span class="ruby-identifier">to_sym</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">nil</span>
66:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000248" class="method-detail">
        <a name="M000248"></a>

        <div class="method-heading">
          <a href="#M000248" class="method-signature">
          <span class="method-name">sha</span><span class="method-args">(check=true)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the <a href="Tree.html#M000248">sha</a> representing the contents
for self. If check is true, <a href="Tree.html#M000248">sha</a> will check
that neither self nor any <a href="Tree.html#M000257">subtree</a> is
modified before returning the <a href="Tree.html#M000248">sha</a>. If
modified, the <a href="Tree.html#M000248">sha</a> is set to nil to flag a
repo to recalculate the <a href="Tree.html#M000248">sha</a> on commit.
</p>
<p>
Note that check does not validate the <a href="Tree.html#M000248">sha</a>
correctly represents the contents of self.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000248-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000248-source">
<pre>
    <span class="ruby-comment cmt"># File lib/gitgo/git/tree.rb, line 81</span>
81:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sha</span>(<span class="ruby-identifier">check</span>=<span class="ruby-keyword kw">true</span>)
82:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@sha</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">check</span>
83:           <span class="ruby-identifier">index</span>.<span class="ruby-identifier">each_value</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
84:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Tree</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">sha</span>.<span class="ruby-identifier">nil?</span>
85:               <span class="ruby-ivar">@sha</span> = <span class="ruby-keyword kw">nil</span>
86:               <span class="ruby-keyword kw">break</span>
87:             <span class="ruby-keyword kw">end</span>
88:           <span class="ruby-keyword kw">end</span>
89:         <span class="ruby-keyword kw">end</span>
90:       
91:         <span class="ruby-ivar">@sha</span>
92:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000247" class="method-detail">
        <a name="M000247"></a>

        <div class="method-heading">
          <a href="#M000247" class="method-signature">
          <span class="method-name">sha=</span><span class="method-args">(sha)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets the <a href="Tree.html#M000248">sha</a> for self. Sha may be set to
nil, in which case it will be calculated when a repo is committed.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000247-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000247-source">
<pre>
    <span class="ruby-comment cmt"># File lib/gitgo/git/tree.rb, line 70</span>
70:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sha=</span>(<span class="ruby-identifier">sha</span>)
71:         <span class="ruby-ivar">@sha</span> = <span class="ruby-identifier">sha</span> <span class="ruby-value">? </span><span class="ruby-identifier">string</span>(<span class="ruby-identifier">sha</span>) <span class="ruby-operator">:</span> <span class="ruby-keyword kw">nil</span>
72:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000257" class="method-detail">
        <a name="M000257"></a>

        <div class="method-heading">
          <a href="#M000257" class="method-signature">
          <span class="method-name">subtree</span><span class="method-args">(segments, force=false)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the <a href="Tree.html#M000257">subtree</a> indicated by the
specified segments (an array of paths), or nil if no such <a
href="Tree.html#M000257">subtree</a> exists. If force is true then missing
subtrees will be created.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000257-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000257-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/git/tree.rb, line 188</span>
188:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">subtree</span>(<span class="ruby-identifier">segments</span>, <span class="ruby-identifier">force</span>=<span class="ruby-keyword kw">false</span>)
189:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">segments</span>.<span class="ruby-identifier">empty?</span>
190:         
191:         <span class="ruby-identifier">key</span> = <span class="ruby-identifier">segments</span>.<span class="ruby-identifier">shift</span>
192:         <span class="ruby-identifier">tree</span> = <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">key</span>]
193: 
194:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">tree</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Tree</span>)
195:           <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">force</span>
196:           <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">key</span>] = <span class="ruby-identifier">tree</span> = <span class="ruby-constant">Tree</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">nil</span>)
197:         <span class="ruby-keyword kw">end</span>
198:         
199:         <span class="ruby-identifier">tree</span>.<span class="ruby-identifier">subtree</span>(<span class="ruby-identifier">segments</span>, <span class="ruby-identifier">force</span>)
200:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000259" class="method-detail">
        <a name="M000259"></a>

        <div class="method-heading">
          <a href="#M000259" class="method-signature">
          <span class="method-name">to_hash</span><span class="method-args">(expand=false)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns self as a hash, expanding if specified.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000259-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000259-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/git/tree.rb, line 221</span>
221:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_hash</span>(<span class="ruby-identifier">expand</span>=<span class="ruby-keyword kw">false</span>)
222:         <span class="ruby-identifier">hash</span> = {}
223:         <span class="ruby-identifier">each_pair</span>(<span class="ruby-identifier">expand</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
224:           <span class="ruby-identifier">hash</span>[<span class="ruby-identifier">key</span>] = <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">value</span>
225:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Tree</span>  <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_hash</span>
226:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Array</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">value</span>
227:           <span class="ruby-keyword kw">else</span> <span class="ruby-identifier">to_entry</span>(<span class="ruby-identifier">value</span>)
228:           <span class="ruby-keyword kw">end</span>
229:         <span class="ruby-keyword kw">end</span>
230:         <span class="ruby-identifier">hash</span>
231:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000262" class="method-detail">
        <a name="M000262"></a>

        <div class="method-heading">
          <a href="#M000262" class="method-signature">
          <span class="method-name">write_to</span><span class="method-args">(git)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Writes self to the git instance. All subtrees will likewise be written.
Returns a [mode, <a href="Tree.html#M000248">sha</a>] entry.
</p>
<p>
<a href="Tree.html">Tree</a> format:
</p>
<pre>
  mode name\0[packedsha]mode name\0[packedsha]...
</pre>
<p>
Note there are no newlines separating tree entries.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000262-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000262-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/git/tree.rb, line 251</span>
251:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">write_to</span>(<span class="ruby-identifier">git</span>)
252:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">mode</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">git</span>.<span class="ruby-identifier">default_tree_mode</span>
253:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">sha</span>  <span class="ruby-operator">||=</span> <span class="ruby-keyword kw">begin</span>
254:           <span class="ruby-identifier">lines</span> = []
255:           <span class="ruby-identifier">each_pair</span>(<span class="ruby-keyword kw">false</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">entry</span><span class="ruby-operator">|</span>
256:             <span class="ruby-identifier">mode</span>, <span class="ruby-identifier">sha</span> = <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">entry</span>
257:             <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Tree</span>  <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">write_to</span>(<span class="ruby-identifier">git</span>)
258:             <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Array</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">entry</span>
259:             <span class="ruby-keyword kw">else</span> [<span class="ruby-identifier">entry</span>.<span class="ruby-identifier">mode</span>, <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">id</span>]
260:             <span class="ruby-keyword kw">end</span>
261:             
262:             <span class="ruby-comment cmt"># modes should not begin with zeros (although it is not fatal</span>
263:             <span class="ruby-comment cmt"># if they do), otherwise fsck will print warnings like this:</span>
264:             <span class="ruby-comment cmt">#</span>
265:             <span class="ruby-comment cmt"># warning in tree 980127...: contains zero-padded file modes</span>
266:             <span class="ruby-identifier">lines</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">zero_strip</span>(<span class="ruby-node">&quot;#{mode} #{key}\0#{[sha].pack(&quot;H*&quot;)}&quot;</span>)
267:           <span class="ruby-keyword kw">end</span>
268: 
269:           <span class="ruby-identifier">git</span>.<span class="ruby-identifier">set</span>(<span class="ruby-identifier">:tree</span>, <span class="ruby-identifier">lines</span>.<span class="ruby-identifier">join</span>)
270:         <span class="ruby-keyword kw">end</span>
271: 
272:         [<span class="ruby-identifier">mode</span>, <span class="ruby-identifier">sha</span>]
273:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>