<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Gitgo::Repo</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Gitgo::Repo</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../files/lib/gitgo/repo_rb.html">
                lib/gitgo/repo.rb
                </a>
        <br />
                <a href="../../files/lib/gitgo/repo/graph_rb.html">
                lib/gitgo/repo/graph.rb
                </a>
        <br />
                <a href="../../files/lib/gitgo/repo/node_rb.html">
                lib/gitgo/repo/node.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
<a href="Repo.html">Repo</a> represents the internal data store used by <a
href="../Gitgo.html">Gitgo</a>. Repos consist of a <a
href="Git.html">Git</a> instance for storing documents in the repository,
and an <a href="Index.html">Index</a> instance for queries on the
documents. The internal workings of <a href="Repo.html">Repo</a> are a bit
complex; this document provides terminology and details on how documents
and <a href="Repo.html#M000160">associations</a> are stored. See <a
href="Index.html">Index</a> and <a href="Repo/Graph.html">Graph</a> for how
document information is accessed.
</p>
<h2>Terminology</h2>
<p>
<a href="../Gitgo.html">Gitgo</a> documents are hashes of attributes that
can be serialized as JSON. The <a href="Document.html">Gitgo::Document</a>
model adds structure to these hashes and enforces data validity, but
insofar as <a href="Repo.html">Repo</a> is concerned, a document is a
serializable hash. <a href="Documents.html">Documents</a> are linked into a
document <a href="Repo.html#M000163">graph</a> &#8212; a directed acyclic
<a href="Repo.html#M000163">graph</a> (DAG) of document nodes that
represent, for example, a chain of comments making a conversation. A given
repo can be thought of as storing multiple DAGs, <a
href="Repo.html#M000162">each</a> made up of multiple documents.
</p>
<p>
The DAGs used by <a href="../Gitgo.html">Gitgo</a> are a little weird
because they use some nodes to represent revisions and other nodes to
represent the &#8216;<a href="Repo.html#M000134">current</a>&#8217; nodes
in a <a href="Repo.html#M000163">graph</a> (this <a
href="Repo.html#M000170">setup</a> allows documents to be immutable, and
thereby to prevent merge conflicts).
</p>
<p>
Normally a DAG has this conceptual structure:
</p>
<pre>
  head
  |
  parent
  |
  node
  |
  child
  |
  tail
</pre>
<p>
By contrast, the DAGs used by <a href="../Gitgo.html">Gitgo</a> are
structured like this:
</p>
<pre>
                          head
                          |
                          parent
                          |
  original -&gt; previous -&gt; node -&gt; update -&gt; current version
                          |
                          child
                          |
                          tail
</pre>
<p>
The extra dimension of updates may be unwound to replace all previous
versions of a node with the <a href="Repo.html#M000134">current</a>
version(s), so for example:
</p>
<pre>
              a                       a
              |                       |
              b -&gt; b'    becomes      b'
              |                       |
              c                       c
</pre>
<p>
The full DAG is refered to as the &#8216;convoluted <a
href="Repo.html#M000163">graph</a>&#8217; and the <a
href="Repo.html#M000134">current</a> DAG is the &#8216;deconvoluted <a
href="Repo.html#M000163">graph</a>&#8217;. The logic performing the
deconvolution is encapsulated in <a href="Repo/Graph.html">Graph</a> and <a
href="Repo/Node.html">Node</a>.
</p>
<p>
Parent-child <a href="Repo.html#M000160">associations</a> are referred to
as links, while previous-<a href="Repo.html#M000155">update</a> <a
href="Repo.html#M000160">associations</a> are referred to as updates. Links
and updates are collectively referred to as <a
href="Repo.html#M000160">associations</a>.
</p>
<p>
There are two additional types of <a
href="Repo.html#M000160">associations</a>; <a
href="Repo.html#M000152">create</a> and <a
href="Repo.html#M000156">delete</a>. Create <a
href="Repo.html#M000160">associations</a> occur when a sha is associated
with the empty sha (ie the sha for an empty document). These <a
href="Repo.html#M000160">associations</a> place <a
href="Repo.html#M000135">new</a> documents along a <a
href="Repo.html#M000140">path</a> in the repo when the <a
href="Repo.html#M000135">new</a> document isn&#8216;t a child or <a
href="Repo.html#M000155">update</a>. Deletes associate a sha with itself;
these act as a break in the DAG such that all subsequent links and updates
are omitted.
</p>
<p>
The first member in an association (parent/previous/sha) is a source and
the second (child/update/sha) is a target.
</p>
<h2>Storage</h2>
<p>
<a href="Documents.html">Documents</a> are stored on a dedicated <a
href="Repo.html#M000141">git</a> <a href="Repo.html#M000137">branch</a> in
a way that prevents merge conflicts and allows merges to directly add nodes
anywhere in a document <a href="Repo.html#M000163">graph</a>. The <a
href="Repo.html#M000137">branch</a> may be checked out and handled like any
other <a href="Repo.html#M000141">git</a> <a
href="Repo.html#M000137">branch</a>, although typically users manage the
gitgo <a href="Repo.html#M000137">branch</a> through <a
href="../Gitgo.html">Gitgo</a> itself.
</p>
<p>
Individual documents are stored with their <a
href="Repo.html#M000160">associations</a> along sha-based paths like
&#8216;so/urce/target&#8217; where the source is split into substrings of
length 2 and 38. The mode and the relationship of the source-target shas
determine the type of association involved. The logic breaks down like this
(&#8217;-&#8217; refers to the empty sha, and a/b to different shas):
</p>
<pre>
  source   target   mode   type
  a        -        644    create
  a        b        644    link
  a        b        640    update
  a        a        644    delete
</pre>
<p>
Using this system, a traveral of the <a
href="Repo.html#M000160">associations</a> is enough to determine how
documents are related in a <a href="Repo.html#M000163">graph</a> without
loading documents into memory.
</p>
<h2>Implementation Note</h2>
<p>
<a href="Repo.html">Repo</a> is organized around an <a
href="Repo.html#M000133">env</a> hash that represents the rack <a
href="Repo.html#M000133">env</a> for a particular request. Objects used by
<a href="Repo.html">Repo</a> are cached into <a
href="Repo.html#M000133">env</a> for re-use across multiple requests, when
possible. The &#8216;gitgo.*&#8217; constants are used to identify cached
objects.
</p>
<p>
<a href="Repo.html">Repo</a> knows how to initialize all the objects it
uses. An empty <a href="Repo.html#M000133">env</a> or a partially filled <a
href="Repo.html#M000133">env</a> may be used to initialize a <a
href="Repo.html">Repo</a>.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000144">[]</a>&nbsp;&nbsp;
      <a href="#M000145">[]=</a>&nbsp;&nbsp;
      <a href="#M000158">assoc_mode</a>&nbsp;&nbsp;
      <a href="#M000157">assoc_sha</a>&nbsp;&nbsp;
      <a href="#M000159">assoc_type</a>&nbsp;&nbsp;
      <a href="#M000160">associations</a>&nbsp;&nbsp;
      <a href="#M000137">branch</a>&nbsp;&nbsp;
      <a href="#M000148">branch?</a>&nbsp;&nbsp;
      <a href="#M000143">cache</a>&nbsp;&nbsp;
      <a href="#M000171">checkout</a>&nbsp;&nbsp;
      <a href="#M000168">commit</a>&nbsp;&nbsp;
      <a href="#M000169">commit!</a>&nbsp;&nbsp;
      <a href="#M000152">create</a>&nbsp;&nbsp;
      <a href="#M000134">current</a>&nbsp;&nbsp;
      <a href="#M000156">delete</a>&nbsp;&nbsp;
      <a href="#M000166">diff</a>&nbsp;&nbsp;
      <a href="#M000162">each</a>&nbsp;&nbsp;
      <a href="#M000161">each_assoc</a>&nbsp;&nbsp;
      <a href="#M000146">empty_sha</a>&nbsp;&nbsp;
      <a href="#M000133">env</a>&nbsp;&nbsp;
      <a href="#M000141">git</a>&nbsp;&nbsp;
      <a href="#M000163">graph</a>&nbsp;&nbsp;
      <a href="#M000136">head</a>&nbsp;&nbsp;
      <a href="#M000142">index</a>&nbsp;&nbsp;
      <a href="#M000130">init</a>&nbsp;&nbsp;
      <a href="#M000154">link</a>&nbsp;&nbsp;
      <a href="#M000135">new</a>&nbsp;&nbsp;
      <a href="#M000140">path</a>&nbsp;&nbsp;
      <a href="#M000153">read</a>&nbsp;&nbsp;
      <a href="#M000149">refs</a>&nbsp;&nbsp;
      <a href="#M000150">remotes</a>&nbsp;&nbsp;
      <a href="#M000172">reset</a>&nbsp;&nbsp;
      <a href="#M000139">resolve</a>&nbsp;&nbsp;
      <a href="#M000165">rev_list</a>&nbsp;&nbsp;
      <a href="#M000151">save</a>&nbsp;&nbsp;
      <a href="#M000173">scope</a>&nbsp;&nbsp;
      <a href="#M000131">set_env</a>&nbsp;&nbsp;
      <a href="#M000170">setup</a>&nbsp;&nbsp;
      <a href="#M000147">sha_path</a>&nbsp;&nbsp;
      <a href="#M000167">status</a>&nbsp;&nbsp;
      <a href="#M000164">timeline</a>&nbsp;&nbsp;
      <a href="#M000155">update</a>&nbsp;&nbsp;
      <a href="#M000138">upstream_branch</a>&nbsp;&nbsp;
      <a href="#M000132">with_env</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">

    <div id="class-list">
      <h3 class="section-bar">Classes and Modules</h3>

      Class <a href="Repo/Graph.html" class="link">Gitgo::Repo::Graph</a><br />
Class <a href="Repo/Node.html" class="link">Gitgo::Repo::Node</a><br />

    </div>

    <div id="constants-list">
      <h3 class="section-bar">Constants</h3>

      <div class="name-list">
        <table summary="Constants">
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">ENVIRONMENT</td>
          <td>=</td>
          <td class="context-item-value">'gitgo.env'</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">PATH</td>
          <td>=</td>
          <td class="context-item-value">'gitgo.path'</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">OPTIONS</td>
          <td>=</td>
          <td class="context-item-value">'gitgo.options'</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">GIT</td>
          <td>=</td>
          <td class="context-item-value">'gitgo.git'</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">INDEX</td>
          <td>=</td>
          <td class="context-item-value">'gitgo.index'</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">REPO</td>
          <td>=</td>
          <td class="context-item-value">'gitgo.repo'</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">CACHE</td>
          <td>=</td>
          <td class="context-item-value">'gitgo.cache'</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">DOCUMENT_PATH</td>
          <td>=</td>
          <td class="context-item-value">/^(.{2})\/(.{38})\/(.{40})$/</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
Matches a <a href="Repo.html#M000140">path</a> &#8212;
&#8216;ab/xyz/sha&#8217;. After the match:

<pre>
 $1:: ab
 $2:: xyz
 $3:: sha
</pre>
</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">DEFAULT_MODE</td>
          <td>=</td>
          <td class="context-item-value">'100644'.to_sym</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
The default blob mode used for added blobs

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">UPDATE_MODE</td>
          <td>=</td>
          <td class="context-item-value">'100640'.to_sym</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
The blob mode used to identify updates

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">FILE</td>
          <td>=</td>
          <td class="context-item-value">'gitgo'</td>
        </tr>
        </table>
      </div>
    </div>



    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">env</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
The repo <a href="Repo.html#M000133">env</a>, typically the same as a
request <a href="Repo.html#M000133">env</a>.

</td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000134" class="method-detail">
        <a name="M000134"></a>

        <div class="method-heading">
          <a href="#M000134" class="method-signature">
          <span class="method-name">current</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the <a href="Repo.html#M000134">current</a> <a
href="Repo.html">Repo</a>, ie <a href="Repo.html#M000133">env</a>[REPO].
Initializes and caches a <a href="Repo.html#M000135">new</a> <a
href="Repo.html">Repo</a> in <a href="Repo.html#M000133">env</a> if <a
href="Repo.html#M000133">env</a>[REPO] is not set.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000134-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000134-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 152</span>
152:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">current</span>
153:         <span class="ruby-identifier">env</span>[<span class="ruby-constant">REPO</span>] <span class="ruby-operator">||=</span> <span class="ruby-identifier">new</span>(<span class="ruby-identifier">env</span>)
154:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000133" class="method-detail">
        <a name="M000133"></a>

        <div class="method-heading">
          <a href="#M000133" class="method-signature">
          <span class="method-name">env</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
The thread-specific <a href="Repo.html#M000133">env</a> currently in <a
href="Repo.html#M000173">scope</a> (see <a
href="Repo.html#M000131">set_env</a>). The <a
href="Repo.html#M000133">env</a> stores all the objects used by a <a
href="Repo.html">Repo</a> and typically represents the rack-<a
href="Repo.html#M000133">env</a> for a specific server request.
</p>
<p>
Raises an error if no <a href="Repo.html#M000133">env</a> is in <a
href="Repo.html#M000173">scope</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000133-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000133-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 146</span>
146:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">env</span>
147:         <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>[<span class="ruby-constant">ENVIRONMENT</span>] <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">raise</span>(<span class="ruby-value str">&quot;no env in scope&quot;</span>)
148:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000130" class="method-detail">
        <a name="M000130"></a>

        <div class="method-heading">
          <a href="#M000130" class="method-signature">
          <span class="method-name">init</span><span class="method-args">(path, options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Initializes a <a href="Repo.html#M000135">new</a> <a
href="Repo.html">Repo</a> to the <a href="Repo.html#M000141">git</a>
repository at the specified <a href="Repo.html#M000140">path</a>. Options
are the same as for <a href="Git.html#M000194">Git.init</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000130-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000130-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 119</span>
119:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">init</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">options</span>={})
120:         <span class="ruby-identifier">git</span> = <span class="ruby-constant">Git</span>.<span class="ruby-identifier">init</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">options</span>)
121:         <span class="ruby-identifier">new</span>(<span class="ruby-constant">GIT</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">git</span>)
122:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000135" class="method-detail">
        <a name="M000135"></a>

        <div class="method-heading">
          <a href="#M000135" class="method-signature">
          <span class="method-name">new</span><span class="method-args">(env={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Initializes a <a href="Repo.html#M000135">new</a> <a
href="Repo.html">Repo</a> with the specified <a
href="Repo.html#M000133">env</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000135-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000135-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 185</span>
185:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">env</span>={})
186:       <span class="ruby-ivar">@env</span> = <span class="ruby-identifier">env</span>
187:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000131" class="method-detail">
        <a name="M000131"></a>

        <div class="method-heading">
          <a href="#M000131" class="method-signature">
          <span class="method-name">set_env</span><span class="method-args">(env)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets <a href="Repo.html#M000133">env</a> as the thread-specific <a
href="Repo.html#M000133">env</a> and returns the currently set <a
href="Repo.html#M000133">env</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000131-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000131-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 125</span>
125:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_env</span>(<span class="ruby-identifier">env</span>)
126:         <span class="ruby-identifier">current</span> = <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>[<span class="ruby-constant">ENVIRONMENT</span>]
127:         <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>[<span class="ruby-constant">ENVIRONMENT</span>] = <span class="ruby-identifier">env</span>
128:         <span class="ruby-identifier">current</span>
129:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000132" class="method-detail">
        <a name="M000132"></a>

        <div class="method-heading">
          <a href="#M000132" class="method-signature">
          <span class="method-name">with_env</span><span class="method-args">(env) {|| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets <a href="Repo.html#M000133">env</a> for the block.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000132-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000132-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 132</span>
132:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">with_env</span>(<span class="ruby-identifier">env</span>)
133:         <span class="ruby-keyword kw">begin</span>
134:           <span class="ruby-identifier">current</span> = <span class="ruby-identifier">set_env</span>(<span class="ruby-identifier">env</span>)
135:           <span class="ruby-keyword kw">yield</span>
136:         <span class="ruby-keyword kw">ensure</span>
137:           <span class="ruby-identifier">set_env</span>(<span class="ruby-identifier">current</span>)
138:         <span class="ruby-keyword kw">end</span>
139:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000144" class="method-detail">
        <a name="M000144"></a>

        <div class="method-heading">
          <a href="#M000144" class="method-signature">
          <span class="method-name">[]</span><span class="method-args">(sha)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the cached attrs hash for the specified sha, or nil.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000144-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000144-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 237</span>
237:     <span class="ruby-keyword kw">def</span> <span class="ruby-operator">[]</span>(<span class="ruby-identifier">sha</span>)
238:       <span class="ruby-identifier">cache</span>[<span class="ruby-identifier">sha</span>]
239:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000145" class="method-detail">
        <a name="M000145"></a>

        <div class="method-heading">
          <a href="#M000145" class="method-signature">
          <span class="method-name">[]=</span><span class="method-args">(sha, attrs)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets the cached attrs for the specified sha.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000145-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000145-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 242</span>
242:     <span class="ruby-keyword kw">def</span> <span class="ruby-operator">[]=</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-identifier">attrs</span>)
243:       <span class="ruby-identifier">cache</span>[<span class="ruby-identifier">sha</span>] = <span class="ruby-identifier">attrs</span>
244:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000158" class="method-detail">
        <a name="M000158"></a>

        <div class="method-heading">
          <a href="#M000158" class="method-signature">
          <span class="method-name">assoc_mode</span><span class="method-args">(source, target)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the mode of the specified association.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000158-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000158-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 348</span>
348:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">assoc_mode</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">target</span>)
349:       <span class="ruby-identifier">tree</span> = <span class="ruby-identifier">git</span>.<span class="ruby-identifier">tree</span>.<span class="ruby-identifier">subtree</span>(<span class="ruby-identifier">sha_path</span>(<span class="ruby-identifier">source</span>))
350:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">tree</span>
351: 
352:       <span class="ruby-identifier">mode</span>, <span class="ruby-identifier">sha</span> = <span class="ruby-identifier">tree</span>[<span class="ruby-identifier">target</span>]
353:       <span class="ruby-identifier">mode</span>
354:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000157" class="method-detail">
        <a name="M000157"></a>

        <div class="method-heading">
          <a href="#M000157" class="method-signature">
          <span class="method-name">assoc_sha</span><span class="method-args">(source, target)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the operative sha in an association, ie the source in a head/delete
association and the target in a link/update association.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000157-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000157-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 339</span>
339:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">assoc_sha</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">target</span>)
340:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">target</span>
341:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">source</span>    <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">source</span>
342:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">empty_sha</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">source</span>
343:       <span class="ruby-keyword kw">else</span> <span class="ruby-identifier">target</span>
344:       <span class="ruby-keyword kw">end</span>
345:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000159" class="method-detail">
        <a name="M000159"></a>

        <div class="method-heading">
          <a href="#M000159" class="method-signature">
          <span class="method-name">assoc_type</span><span class="method-args">(source, target, mode=assoc_mode(source, target))</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the association type given the source, target, and mode.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000159-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000159-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 357</span>
357:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">assoc_type</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">target</span>, <span class="ruby-identifier">mode</span>=<span class="ruby-identifier">assoc_mode</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">target</span>))
358:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">mode</span>
359:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">DEFAULT_MODE</span>
360:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">target</span>
361:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">empty_sha</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">:create</span>
362:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">source</span>    <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">:delete</span>
363:         <span class="ruby-keyword kw">else</span> <span class="ruby-identifier">:link</span>
364:         <span class="ruby-keyword kw">end</span>
365:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">UPDATE_MODE</span>
366:         <span class="ruby-identifier">:update</span>
367:       <span class="ruby-keyword kw">else</span>
368:         <span class="ruby-identifier">:invalid</span>
369:       <span class="ruby-keyword kw">end</span>
370:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000160" class="method-detail">
        <a name="M000160"></a>

        <div class="method-heading">
          <a href="#M000160" class="method-signature">
          <span class="method-name">associations</span><span class="method-args">(source, sort=true)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns a hash of <a href="Repo.html#M000160">associations</a> for the
source, mainly used as a convenience method during testing.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000160-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000160-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 374</span>
374:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">associations</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">sort</span>=<span class="ruby-keyword kw">true</span>)
375:       <span class="ruby-identifier">associations</span> = {}
376:       <span class="ruby-identifier">links</span> = []
377:       <span class="ruby-identifier">updates</span> = []
378:       
379:       <span class="ruby-identifier">each_assoc</span>(<span class="ruby-identifier">source</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">sha</span>, <span class="ruby-identifier">type</span><span class="ruby-operator">|</span>
380:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">type</span>
381:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:create</span>, <span class="ruby-identifier">:delete</span>
382:           <span class="ruby-identifier">associations</span>[<span class="ruby-identifier">type</span>] = <span class="ruby-keyword kw">true</span>
383:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:link</span>
384:           <span class="ruby-identifier">links</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">sha</span>
385:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:update</span>
386:           <span class="ruby-identifier">updates</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">sha</span>
387:         <span class="ruby-keyword kw">end</span>
388:       <span class="ruby-keyword kw">end</span>
389:       
390:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">links</span>.<span class="ruby-identifier">empty?</span>
391:         
392:         <span class="ruby-identifier">associations</span>[<span class="ruby-identifier">:links</span>] = <span class="ruby-identifier">links</span>
393:       <span class="ruby-keyword kw">end</span>
394:       
395:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">updates</span>.<span class="ruby-identifier">empty?</span>
396:         <span class="ruby-identifier">updates</span>.<span class="ruby-identifier">sort!</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sort</span>
397:         <span class="ruby-identifier">associations</span>[<span class="ruby-identifier">:updates</span>] = <span class="ruby-identifier">updates</span>
398:       <span class="ruby-keyword kw">end</span>
399:       
400:       <span class="ruby-identifier">associations</span>
401:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000137" class="method-detail">
        <a name="M000137"></a>

        <div class="method-heading">
          <a href="#M000137" class="method-signature">
          <span class="method-name">branch</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000137-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000137-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 193</span>
193:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">branch</span>
194:       <span class="ruby-identifier">git</span>.<span class="ruby-identifier">branch</span>
195:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000148" class="method-detail">
        <a name="M000148"></a>

        <div class="method-heading">
          <a href="#M000148" class="method-signature">
          <span class="method-name">branch?</span><span class="method-args">(sha)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns true if the given <a href="Repo.html#M000168">commit</a> has an
empty &#8216;gitgo&#8217; file in it&#8216;s tree.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000148-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000148-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 260</span>
260:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">branch?</span>(<span class="ruby-identifier">sha</span>)
261:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sha</span>.<span class="ruby-identifier">nil?</span>
262:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">sha</span> = <span class="ruby-identifier">resolve</span>(<span class="ruby-identifier">sha</span>)
263:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">commit</span> = <span class="ruby-identifier">git</span>.<span class="ruby-identifier">get</span>(<span class="ruby-identifier">:commit</span>, <span class="ruby-identifier">sha</span>)
264:       
265:       <span class="ruby-identifier">blob</span> = <span class="ruby-identifier">commit</span>.<span class="ruby-identifier">tree</span><span class="ruby-operator">/</span><span class="ruby-constant">FILE</span>
266:       <span class="ruby-identifier">blob</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">blob</span>.<span class="ruby-identifier">data</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-value">? </span><span class="ruby-keyword kw">true</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">false</span>
267:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000143" class="method-detail">
        <a name="M000143"></a>

        <div class="method-heading">
          <a href="#M000143" class="method-signature">
          <span class="method-name">cache</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns or initializes a self-populating <a
href="Repo.html#M000143">cache</a> of attribute hashes in <a
href="Repo.html#M000133">env</a>[CACHE]. Attribute hashes are are keyed by
sha.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000143-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000143-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 232</span>
232:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cache</span>
233:       <span class="ruby-identifier">env</span>[<span class="ruby-constant">CACHE</span>] <span class="ruby-operator">||=</span> <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">hash</span>, <span class="ruby-identifier">sha</span><span class="ruby-operator">|</span> <span class="ruby-identifier">hash</span>[<span class="ruby-identifier">sha</span>] = <span class="ruby-identifier">read</span>(<span class="ruby-identifier">sha</span>) }
234:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000171" class="method-detail">
        <a name="M000171"></a>

        <div class="method-heading">
          <a href="#M000171" class="method-signature">
          <span class="method-name">checkout</span><span class="method-args">(branch)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000171-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000171-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 589</span>
589:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">checkout</span>(<span class="ruby-identifier">branch</span>)
590:       <span class="ruby-identifier">git</span>.<span class="ruby-identifier">checkout</span>(<span class="ruby-identifier">branch</span>)
591:       <span class="ruby-keyword kw">self</span>
592:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000168" class="method-detail">
        <a name="M000168"></a>

        <div class="method-heading">
          <a href="#M000168" class="method-signature">
          <span class="method-name">commit</span><span class="method-args">(msg=status)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Commits any changes to <a href="Repo.html#M000141">git</a> and writes the
<a href="Repo.html#M000142">index</a> to disk. The <a
href="Repo.html#M000168">commit</a> message is inferred from the <a
href="Repo.html#M000167">status</a>, if left unspecified. Commit will raise
an error if there are no changes to <a href="Repo.html#M000168">commit</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000168-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000168-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 538</span>
538:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">commit</span>(<span class="ruby-identifier">msg</span>=<span class="ruby-identifier">status</span>)
539:       <span class="ruby-identifier">setup</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">head</span>
540:       
541:       <span class="ruby-identifier">sha</span> = <span class="ruby-identifier">git</span>.<span class="ruby-identifier">commit</span>(<span class="ruby-identifier">msg</span>)
542:       <span class="ruby-identifier">index</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">sha</span>)
543:       <span class="ruby-identifier">sha</span>
544:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000169" class="method-detail">
        <a name="M000169"></a>

        <div class="method-heading">
          <a href="#M000169" class="method-signature">
          <span class="method-name">commit!</span><span class="method-args">(msg=status)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Same as <a href="Repo.html#M000168">commit</a> but does not check if there
are changes to <a href="Repo.html#M000168">commit</a>, useful when you know
there are changes to <a href="Repo.html#M000168">commit</a> and don&#8216;t
want the overhead of checking for changes.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000169-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000169-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 549</span>
549:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">commit!</span>(<span class="ruby-identifier">msg</span>=<span class="ruby-identifier">status</span>)
550:       <span class="ruby-identifier">setup</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">head</span>
551:       
552:       <span class="ruby-identifier">sha</span> = <span class="ruby-identifier">git</span>.<span class="ruby-identifier">commit!</span>(<span class="ruby-identifier">msg</span>)
553:       <span class="ruby-identifier">index</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">sha</span>)
554:       <span class="ruby-identifier">sha</span>
555:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000152" class="method-detail">
        <a name="M000152"></a>

        <div class="method-heading">
          <a href="#M000152" class="method-signature">
          <span class="method-name">create</span><span class="method-args">(sha)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Creates a <a href="Repo.html#M000152">create</a> association for the sha:
</p>
<pre>
  sh/a/empty_sha (DEFAULT_MODE, sha)
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000152-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000152-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 295</span>
295:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create</span>(<span class="ruby-identifier">sha</span>)
296:       <span class="ruby-identifier">git</span>[<span class="ruby-identifier">sha_path</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-identifier">empty_sha</span>)] = [<span class="ruby-constant">DEFAULT_MODE</span>, <span class="ruby-identifier">sha</span>]
297:       <span class="ruby-identifier">sha</span>
298:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000156" class="method-detail">
        <a name="M000156"></a>

        <div class="method-heading">
          <a href="#M000156" class="method-signature">
          <span class="method-name">delete</span><span class="method-args">(sha)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Creates a <a href="Repo.html#M000156">delete</a> association for the sha:
</p>
<pre>
  sh/a/sha (DEFAULT_MODE, empty_sha)
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000156-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000156-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 332</span>
332:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete</span>(<span class="ruby-identifier">sha</span>)
333:       <span class="ruby-identifier">git</span>[<span class="ruby-identifier">sha_path</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-identifier">sha</span>)] = [<span class="ruby-constant">DEFAULT_MODE</span>, <span class="ruby-identifier">empty_sha</span>]
334:       <span class="ruby-keyword kw">self</span>
335:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000166" class="method-detail">
        <a name="M000166"></a>

        <div class="method-heading">
          <a href="#M000166" class="method-signature">
          <span class="method-name">diff</span><span class="method-args">(a, b, type='A')</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns a list of document shas that have been added (&#8216;A&#8217;)
between a and
</p>
<ol>
<li type="a">Deleted (&#8216;D&#8217;) or modified (&#8216;M&#8217;) documents can be
specified using

</li>
</ol>
<p>
type.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000166-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000166-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 479</span>
479:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">diff</span>(<span class="ruby-identifier">a</span>, <span class="ruby-identifier">b</span>, <span class="ruby-identifier">type</span>=<span class="ruby-value str">'A'</span>)
480:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">a</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">b</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">nil?</span>
481:         <span class="ruby-keyword kw">return</span> []
482:       <span class="ruby-keyword kw">end</span>
483:       
484:       <span class="ruby-identifier">paths</span> = <span class="ruby-identifier">a</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-identifier">git</span>.<span class="ruby-identifier">ls_tree</span>(<span class="ruby-identifier">b</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">git</span>.<span class="ruby-identifier">diff_tree</span>(<span class="ruby-identifier">a</span>, <span class="ruby-identifier">b</span>)[<span class="ruby-identifier">type</span>]
485:       <span class="ruby-identifier">paths</span>.<span class="ruby-identifier">collect!</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span>
486:         <span class="ruby-identifier">ab</span>, <span class="ruby-identifier">xyz</span>, <span class="ruby-identifier">target</span> = <span class="ruby-identifier">path</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">'/'</span>, <span class="ruby-value">3</span>)
487:         <span class="ruby-identifier">assoc_sha</span>(<span class="ruby-node">&quot;#{ab}#{xyz}&quot;</span>, <span class="ruby-identifier">target</span>)
488:       <span class="ruby-keyword kw">end</span>
489: 
490:       <span class="ruby-identifier">paths</span>.<span class="ruby-identifier">compact!</span>
491:       <span class="ruby-identifier">paths</span>
492:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000162" class="method-detail">
        <a name="M000162"></a>

        <div class="method-heading">
          <a href="#M000162" class="method-signature">
          <span class="method-name">each</span><span class="method-args">() {|doc_sha| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Yields the sha of <a href="Repo.html#M000162">each</a> document in the
repo, in no particular order and with duplicates for every link/update that
has multiple association sources.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000162-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000162-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 419</span>
419:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each</span>
420:       <span class="ruby-identifier">git</span>.<span class="ruby-identifier">tree</span>.<span class="ruby-identifier">each_pair</span>(<span class="ruby-keyword kw">true</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ab</span>, <span class="ruby-identifier">xyz_tree</span><span class="ruby-operator">|</span>
421:         <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">ab</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span>
422:         
423:         <span class="ruby-identifier">xyz_tree</span>.<span class="ruby-identifier">each_pair</span>(<span class="ruby-keyword kw">true</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">xyz</span>, <span class="ruby-identifier">target_tree</span><span class="ruby-operator">|</span>
424:           <span class="ruby-identifier">source</span> = <span class="ruby-node">&quot;#{ab}#{xyz}&quot;</span>
425:           
426:           <span class="ruby-identifier">target_tree</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">target</span><span class="ruby-operator">|</span>
427:             <span class="ruby-identifier">doc_sha</span> = <span class="ruby-identifier">assoc_sha</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">target</span>)
428:             <span class="ruby-keyword kw">yield</span>(<span class="ruby-identifier">doc_sha</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">doc_sha</span>
429:           <span class="ruby-keyword kw">end</span>
430:         <span class="ruby-keyword kw">end</span>
431:       <span class="ruby-keyword kw">end</span>
432:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000161" class="method-detail">
        <a name="M000161"></a>

        <div class="method-heading">
          <a href="#M000161" class="method-signature">
          <span class="method-name">each_assoc</span><span class="method-args">(source) {|sha, type| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Yield <a href="Repo.html#M000162">each</a> association for source to the
block, with the association sha and type. Returns self.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000161-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000161-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 405</span>
405:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each_assoc</span>(<span class="ruby-identifier">source</span>) <span class="ruby-comment cmt"># :yields: sha, type</span>
406:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">source</span>.<span class="ruby-identifier">nil?</span>
407:       
408:       <span class="ruby-identifier">target_tree</span> = <span class="ruby-identifier">git</span>.<span class="ruby-identifier">tree</span>.<span class="ruby-identifier">subtree</span>(<span class="ruby-identifier">sha_path</span>(<span class="ruby-identifier">source</span>))
409:       <span class="ruby-identifier">target_tree</span>.<span class="ruby-identifier">each_pair</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">target</span>, (<span class="ruby-identifier">mode</span>, <span class="ruby-identifier">sha</span>)<span class="ruby-operator">|</span>
410:         <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">assoc_sha</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">target</span>), <span class="ruby-identifier">assoc_type</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">target</span>, <span class="ruby-identifier">mode</span>)
411:       <span class="ruby-keyword kw">end</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">target_tree</span>
412:       
413:       <span class="ruby-keyword kw">self</span>
414:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000146" class="method-detail">
        <a name="M000146"></a>

        <div class="method-heading">
          <a href="#M000146" class="method-signature">
          <span class="method-name">empty_sha</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the sha for an empty string, and ensures the corresponding object
is set in the repo.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000146-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000146-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 248</span>
248:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">empty_sha</span>
249:       <span class="ruby-ivar">@empty_sha</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">git</span>.<span class="ruby-identifier">set</span>(<span class="ruby-identifier">:blob</span>, <span class="ruby-value str">''</span>)
250:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000141" class="method-detail">
        <a name="M000141"></a>

        <div class="method-heading">
          <a href="#M000141" class="method-signature">
          <span class="method-name">git</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the <a href="Git.html">Git</a> instance set in <a
href="Repo.html#M000133">env</a>[GIT]. If no instance is set then one will
be initialized using <a href="Repo.html#M000133">env</a>[PATH] and <a
href="Repo.html#M000133">env</a>[OPTIONS].
</p>
<p>
Note that given the chain of defaults, <a href="Repo.html#M000141">git</a>
will be initialized to Dir.pwd if the <a href="Repo.html#M000133">env</a>
has no PATH or GIT set.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000141-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000141-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 216</span>
216:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">git</span>
217:       <span class="ruby-identifier">env</span>[<span class="ruby-constant">GIT</span>] <span class="ruby-operator">||=</span> <span class="ruby-constant">Git</span>.<span class="ruby-identifier">init</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">env</span>[<span class="ruby-constant">OPTIONS</span>] <span class="ruby-operator">||</span> {})
218:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000163" class="method-detail">
        <a name="M000163"></a>

        <div class="method-heading">
          <a href="#M000163" class="method-signature">
          <span class="method-name">graph</span><span class="method-args">(sha)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Initializes a <a href="Repo/Graph.html">Graph</a> for the sha.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000163-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000163-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 435</span>
435:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">graph</span>(<span class="ruby-identifier">sha</span>)
436:       <span class="ruby-constant">Graph</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">sha</span>)
437:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000136" class="method-detail">
        <a name="M000136"></a>

        <div class="method-heading">
          <a href="#M000136" class="method-signature">
          <span class="method-name">head</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000136-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000136-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 189</span>
189:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">head</span>
190:       <span class="ruby-identifier">git</span>.<span class="ruby-identifier">head</span>
191:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000142" class="method-detail">
        <a name="M000142"></a>

        <div class="method-heading">
          <a href="#M000142" class="method-signature">
          <span class="method-name">index</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the <a href="Index.html">Index</a> instance set in <a
href="Repo.html#M000133">env</a>[INDEX]. If no instance is set then one
will be initialized under the <a href="Repo.html#M000141">git</a> working
directory, specific to the <a href="Repo.html#M000141">git</a> <a
href="Repo.html#M000137">branch</a>. For instance:
</p>
<pre>
  .git/gitgo/refs/branch/index
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000142-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000142-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 226</span>
226:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">index</span>
227:       <span class="ruby-identifier">env</span>[<span class="ruby-constant">INDEX</span>] <span class="ruby-operator">||=</span> <span class="ruby-constant">Index</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">git</span>.<span class="ruby-identifier">work_dir</span>, <span class="ruby-value str">'refs'</span>, <span class="ruby-identifier">git</span>.<span class="ruby-identifier">branch</span>, <span class="ruby-value str">'index'</span>))
228:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000154" class="method-detail">
        <a name="M000154"></a>

        <div class="method-heading">
          <a href="#M000154" class="method-signature">
          <span class="method-name">link</span><span class="method-args">(parent, child)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Creates a <a href="Repo.html#M000154">link</a> association for parent and
child:
</p>
<pre>
  pa/rent/child (DEFAULT_MODE, child)
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000154-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000154-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 314</span>
314:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">link</span>(<span class="ruby-identifier">parent</span>, <span class="ruby-identifier">child</span>)
315:       <span class="ruby-identifier">git</span>[<span class="ruby-identifier">sha_path</span>(<span class="ruby-identifier">parent</span>, <span class="ruby-identifier">child</span>)] = [<span class="ruby-constant">DEFAULT_MODE</span>, <span class="ruby-identifier">child</span>]
316:       <span class="ruby-keyword kw">self</span>
317:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000140" class="method-detail">
        <a name="M000140"></a>

        <div class="method-heading">
          <a href="#M000140" class="method-signature">
          <span class="method-name">path</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the <a href="Repo.html#M000140">path</a> to <a
href="Repo.html#M000141">git</a> repository. Path is determined from <a
href="Repo.html#M000133">env</a>[PATH], or inferred and set in <a
href="Repo.html#M000133">env</a> from <a
href="Repo.html#M000133">env</a>[GIT]. The default <a
href="Repo.html#M000140">path</a> is Dir.pwd.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000140-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000140-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 207</span>
207:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">path</span>
208:       <span class="ruby-identifier">env</span>[<span class="ruby-constant">PATH</span>] <span class="ruby-operator">||=</span> (<span class="ruby-identifier">env</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-constant">GIT</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">env</span>[<span class="ruby-constant">GIT</span>].<span class="ruby-identifier">path</span> <span class="ruby-operator">:</span> <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">pwd</span>)
209:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000153" class="method-detail">
        <a name="M000153"></a>

        <div class="method-heading">
          <a href="#M000153" class="method-signature">
          <span class="method-name">read</span><span class="method-args">(sha)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Reads and deserializes the specified hash of attrs. If sha does not
indicate a blob that deserializes as JSON then <a
href="Repo.html#M000153">read</a> returns nil.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000153-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000153-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 302</span>
302:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">read</span>(<span class="ruby-identifier">sha</span>)
303:       <span class="ruby-keyword kw">begin</span>
304:         <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">git</span>.<span class="ruby-identifier">get</span>(<span class="ruby-identifier">:blob</span>, <span class="ruby-identifier">sha</span>).<span class="ruby-identifier">data</span>)
305:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">JSON</span><span class="ruby-operator">::</span><span class="ruby-constant">ParserError</span>, <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">EISDIR</span> 
306:         <span class="ruby-keyword kw">nil</span>
307:       <span class="ruby-keyword kw">end</span>
308:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000149" class="method-detail">
        <a name="M000149"></a>

        <div class="method-heading">
          <a href="#M000149" class="method-signature">
          <span class="method-name">refs</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns an array of <a href="Repo.html#M000149">refs</a> representing gitgo
branches.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000149-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000149-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 270</span>
270:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">refs</span>
271:       <span class="ruby-identifier">select_branches</span>(<span class="ruby-identifier">git</span>.<span class="ruby-identifier">grit</span>.<span class="ruby-identifier">refs</span>)
272:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000150" class="method-detail">
        <a name="M000150"></a>

        <div class="method-heading">
          <a href="#M000150" class="method-signature">
          <span class="method-name">remotes</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns an array of <a href="Repo.html#M000150">remotes</a> representing
gitgo branches.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000150-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000150-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 275</span>
275:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">remotes</span>
276:       <span class="ruby-identifier">select_branches</span>(<span class="ruby-identifier">git</span>.<span class="ruby-identifier">grit</span>.<span class="ruby-identifier">remotes</span>)
277:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000172" class="method-detail">
        <a name="M000172"></a>

        <div class="method-heading">
          <a href="#M000172" class="method-signature">
          <span class="method-name">reset</span><span class="method-args">(full=false)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000172-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000172-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 594</span>
594:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reset</span>(<span class="ruby-identifier">full</span>=<span class="ruby-keyword kw">false</span>)
595:       <span class="ruby-identifier">git</span>.<span class="ruby-identifier">reset</span>(<span class="ruby-identifier">full</span>)
596:       <span class="ruby-identifier">cache</span>.<span class="ruby-identifier">clear</span>
597:       <span class="ruby-identifier">index</span>.<span class="ruby-identifier">reset</span>
598:       <span class="ruby-keyword kw">self</span>
599:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000139" class="method-detail">
        <a name="M000139"></a>

        <div class="method-heading">
          <a href="#M000139" class="method-signature">
          <span class="method-name">resolve</span><span class="method-args">(sha)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000139-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000139-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 201</span>
201:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">resolve</span>(<span class="ruby-identifier">sha</span>)
202:       <span class="ruby-identifier">git</span>.<span class="ruby-identifier">resolve</span>(<span class="ruby-identifier">sha</span>) <span class="ruby-keyword kw">rescue</span> <span class="ruby-identifier">sha</span>
203:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000165" class="method-detail">
        <a name="M000165"></a>

        <div class="method-heading">
          <a href="#M000165" class="method-signature">
          <span class="method-name">rev_list</span><span class="method-args">(sha)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns an array of revisions (commits) reachable from the sha. These
revisions are cached for quick retreival.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000165-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000165-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 467</span>
467:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rev_list</span>(<span class="ruby-identifier">sha</span>)
468:       <span class="ruby-identifier">sha</span> = <span class="ruby-identifier">sha</span>.<span class="ruby-identifier">to_sym</span>
469:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">cache</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">sha</span>)
470:         <span class="ruby-identifier">cache</span>[<span class="ruby-identifier">sha</span>] = <span class="ruby-identifier">git</span>.<span class="ruby-identifier">rev_list</span>(<span class="ruby-identifier">sha</span>.<span class="ruby-identifier">to_s</span>)
471:       <span class="ruby-keyword kw">end</span>
472:       
473:       <span class="ruby-identifier">cache</span>[<span class="ruby-identifier">sha</span>]
474:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000151" class="method-detail">
        <a name="M000151"></a>

        <div class="method-heading">
          <a href="#M000151" class="method-signature">
          <span class="method-name">save</span><span class="method-args">(attrs)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Serializes and sets the attributes as a blob in the <a
href="Repo.html#M000141">git</a> repo and caches the attributes by the blob
sha. Returns the blob sha.
</p>
<p>
Note that <a href="Repo.html#M000151">save</a> does not put the blob along
a <a href="Repo.html#M000140">path</a> in the repo; immediately after <a
href="Repo.html#M000151">save</a> the blob is hanging and will be
gc&#8216;ed by <a href="Repo.html#M000141">git</a> unless set into a <a
href="Repo.html#M000140">path</a> by <a
href="Repo.html#M000152">create</a>, <a href="Repo.html#M000154">link</a>,
or <a href="Repo.html#M000155">update</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000151-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000151-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 285</span>
285:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">save</span>(<span class="ruby-identifier">attrs</span>)
286:       <span class="ruby-identifier">sha</span> = <span class="ruby-identifier">git</span>.<span class="ruby-identifier">set</span>(<span class="ruby-identifier">:blob</span>, <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">generate</span>(<span class="ruby-identifier">attrs</span>))
287:       <span class="ruby-identifier">cache</span>[<span class="ruby-identifier">sha</span>] = <span class="ruby-identifier">attrs</span>
288:       <span class="ruby-identifier">sha</span>
289:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000173" class="method-detail">
        <a name="M000173"></a>

        <div class="method-heading">
          <a href="#M000173" class="method-signature">
          <span class="method-name">scope</span><span class="method-args">() {|| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets self as the <a href="Repo.html#M000134">current</a> <a
href="Repo.html">Repo</a> for the duration of the block.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000173-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000173-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 602</span>
602:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">scope</span>
603:       <span class="ruby-constant">Repo</span>.<span class="ruby-identifier">with_env</span>(<span class="ruby-constant">REPO</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">self</span>) { <span class="ruby-keyword kw">yield</span> }
604:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000170" class="method-detail">
        <a name="M000170"></a>

        <div class="method-heading">
          <a href="#M000170" class="method-signature">
          <span class="method-name">setup</span><span class="method-args">(upstream_branch=nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000170-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000170-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 557</span>
557:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">setup</span>(<span class="ruby-identifier">upstream_branch</span>=<span class="ruby-keyword kw">nil</span>)
558:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">head</span>
559:         <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;already setup on: #{branch} (#{head})&quot;</span>
560:       <span class="ruby-keyword kw">end</span>
561:       
562:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">upstream_branch</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">upstream_branch</span>.<span class="ruby-identifier">empty?</span>
563:         <span class="ruby-identifier">tree</span> = <span class="ruby-constant">Git</span><span class="ruby-operator">::</span><span class="ruby-constant">Tree</span>.<span class="ruby-identifier">new</span>
564:         <span class="ruby-identifier">tree</span>[<span class="ruby-constant">FILE</span>] = [<span class="ruby-identifier">git</span>.<span class="ruby-identifier">default_blob_mode</span>, <span class="ruby-identifier">empty_sha</span>]
565:         <span class="ruby-identifier">mode</span>, <span class="ruby-identifier">sha</span> = <span class="ruby-identifier">tree</span>.<span class="ruby-identifier">write_to</span>(<span class="ruby-identifier">git</span>)
566:         <span class="ruby-identifier">git</span>.<span class="ruby-identifier">commit!</span>(<span class="ruby-value str">&quot;setup gitgo&quot;</span>, <span class="ruby-identifier">:tree</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">sha</span>)
567:         
568:         <span class="ruby-identifier">current_tree</span> = <span class="ruby-identifier">git</span>.<span class="ruby-identifier">tree</span>
569:         <span class="ruby-identifier">git</span>.<span class="ruby-identifier">reset</span>
570:         <span class="ruby-identifier">git</span>.<span class="ruby-identifier">tree</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">current_tree</span>)
571:         
572:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span>
573:       <span class="ruby-keyword kw">end</span>
574:       
575:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">branch?</span>(<span class="ruby-identifier">upstream_branch</span>)
576:         <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;not a gitgo branch: #{upstream_branch.inspect}&quot;</span>
577:       <span class="ruby-keyword kw">end</span>
578:       
579:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">git</span>.<span class="ruby-identifier">tracking_branch?</span>(<span class="ruby-identifier">upstream_branch</span>)
580:         <span class="ruby-identifier">git</span>.<span class="ruby-identifier">track</span>(<span class="ruby-identifier">upstream_branch</span>)
581:       <span class="ruby-keyword kw">end</span>
582:       <span class="ruby-identifier">git</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">upstream_branch</span>)
583:       
584:       <span class="ruby-identifier">cache</span>.<span class="ruby-identifier">clear</span>
585:       <span class="ruby-identifier">index</span>.<span class="ruby-identifier">reset</span>
586:       <span class="ruby-keyword kw">self</span>
587:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000147" class="method-detail">
        <a name="M000147"></a>

        <div class="method-heading">
          <a href="#M000147" class="method-signature">
          <span class="method-name">sha_path</span><span class="method-args">(sha, *paths)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Creates a nested sha <a href="Repo.html#M000140">path</a> like:
ab/xyz/paths
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000147-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000147-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 253</span>
253:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sha_path</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">paths</span>)
254:       <span class="ruby-identifier">paths</span>.<span class="ruby-identifier">unshift</span> <span class="ruby-identifier">sha</span>[<span class="ruby-value">2</span>,<span class="ruby-value">38</span>]
255:       <span class="ruby-identifier">paths</span>.<span class="ruby-identifier">unshift</span> <span class="ruby-identifier">sha</span>[<span class="ruby-value">0</span>,<span class="ruby-value">2</span>]
256:       <span class="ruby-identifier">paths</span>
257:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000167" class="method-detail">
        <a name="M000167"></a>

        <div class="method-heading">
          <a href="#M000167" class="method-signature">
          <span class="method-name">status</span><span class="method-args">() {|sha| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Generates a <a href="Repo.html#M000167">status</a> message based on
currently uncommitted changes.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000167-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000167-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 495</span>
495:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">status</span>
496:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">block_given?</span>
497:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">status</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">sha</span><span class="ruby-operator">|</span> <span class="ruby-identifier">sha</span>}
498:       <span class="ruby-keyword kw">end</span>
499:       
500:       <span class="ruby-identifier">lines</span> = []
501:       <span class="ruby-identifier">git</span>.<span class="ruby-identifier">status</span>.<span class="ruby-identifier">each_pair</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">path</span>, <span class="ruby-identifier">state</span><span class="ruby-operator">|</span>
502:         <span class="ruby-identifier">ab</span>, <span class="ruby-identifier">xyz</span>, <span class="ruby-identifier">target</span> = <span class="ruby-identifier">path</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">'/'</span>, <span class="ruby-value">3</span>)
503:         <span class="ruby-identifier">source</span> = <span class="ruby-node">&quot;#{ab}#{xyz}&quot;</span>
504:         
505:         <span class="ruby-identifier">sha</span>  = <span class="ruby-identifier">assoc_sha</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">target</span>)
506:         <span class="ruby-identifier">type</span> = <span class="ruby-identifier">assoc_type</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">target</span>)
507:         
508:         <span class="ruby-identifier">status</span> = <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">assoc_type</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">target</span>)
509:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:create</span>
510:           <span class="ruby-identifier">type</span> = <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">sha</span>][<span class="ruby-value str">'type'</span>]
511:           [<span class="ruby-identifier">type</span> <span class="ruby-operator">||</span> <span class="ruby-value str">'doc'</span>, <span class="ruby-keyword kw">yield</span>(<span class="ruby-identifier">sha</span>)]
512:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:link</span>
513:           [<span class="ruby-value str">'link'</span>, <span class="ruby-node">&quot;#{yield(source)} to  #{yield(target)}&quot;</span>]
514:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:update</span>
515:           [<span class="ruby-value str">'update'</span>, <span class="ruby-node">&quot;#{yield(target)} was #{yield(source)}&quot;</span>]
516:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:delete</span>
517:           [<span class="ruby-value str">'delete'</span>, <span class="ruby-keyword kw">yield</span>(<span class="ruby-identifier">sha</span>)]
518:         <span class="ruby-keyword kw">else</span>
519:           [<span class="ruby-value str">'unknown'</span>, <span class="ruby-identifier">path</span>]
520:         <span class="ruby-keyword kw">end</span>
521:         
522:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">status</span>
523:           <span class="ruby-identifier">status</span>.<span class="ruby-identifier">unshift</span> <span class="ruby-identifier">state_str</span>(<span class="ruby-identifier">state</span>)
524:           <span class="ruby-identifier">lines</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">status</span>
525:         <span class="ruby-keyword kw">end</span>
526:       <span class="ruby-keyword kw">end</span>
527:       
528:       <span class="ruby-identifier">indent</span> = <span class="ruby-identifier">lines</span>.<span class="ruby-identifier">collect</span> {<span class="ruby-operator">|</span>(<span class="ruby-identifier">state</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">msg</span>)<span class="ruby-operator">|</span> <span class="ruby-identifier">type</span>.<span class="ruby-identifier">length</span> }.<span class="ruby-identifier">max</span>
529:       <span class="ruby-identifier">format</span> = <span class="ruby-node">&quot;%s %-#{indent}s %s&quot;</span>
530:       <span class="ruby-identifier">lines</span>.<span class="ruby-identifier">collect!</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">ary</span><span class="ruby-operator">|</span> <span class="ruby-identifier">format</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">ary</span> }
531:       <span class="ruby-identifier">lines</span>.<span class="ruby-identifier">sort!</span>
532:       <span class="ruby-identifier">lines</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
533:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000164" class="method-detail">
        <a name="M000164"></a>

        <div class="method-heading">
          <a href="#M000164" class="method-signature">
          <span class="method-name">timeline</span><span class="method-args">(options={}) {|sha| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns an array of shas representing recent documents added.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000164-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000164-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 440</span>
440:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">timeline</span>(<span class="ruby-identifier">options</span>={})
441:       <span class="ruby-identifier">options</span> = {<span class="ruby-identifier">:n</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">10</span>, <span class="ruby-identifier">:offset</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>}.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">options</span>)
442:       <span class="ruby-identifier">offset</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:offset</span>]
443:       <span class="ruby-identifier">n</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:n</span>]
444: 
445:       <span class="ruby-identifier">shas</span> = []
446:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">shas</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">n</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">0</span>
447:       
448:       <span class="ruby-identifier">dates</span> = <span class="ruby-identifier">index</span>.<span class="ruby-identifier">values</span>(<span class="ruby-value str">'date'</span>).<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">reverse</span>
449:       <span class="ruby-identifier">index</span>.<span class="ruby-identifier">each_sha</span>(<span class="ruby-value str">'date'</span>, <span class="ruby-identifier">dates</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">sha</span><span class="ruby-operator">|</span>
450:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
451:           <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">yield</span>(<span class="ruby-identifier">sha</span>)
452:         <span class="ruby-keyword kw">end</span>
453:         
454:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">offset</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
455:           <span class="ruby-identifier">offset</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
456:         <span class="ruby-keyword kw">else</span>
457:           <span class="ruby-identifier">shas</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">sha</span>
458:           <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">n</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">shas</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">n</span>
459:         <span class="ruby-keyword kw">end</span>
460:       <span class="ruby-keyword kw">end</span>
461:       
462:       <span class="ruby-identifier">shas</span>
463:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000155" class="method-detail">
        <a name="M000155"></a>

        <div class="method-heading">
          <a href="#M000155" class="method-signature">
          <span class="method-name">update</span><span class="method-args">(old_sha, new_sha)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Creates an <a href="Repo.html#M000155">update</a> association for old and
<a href="Repo.html#M000135">new</a> shas:
</p>
<pre>
  ol/d_sha/new_sha (UPDATE_MODE, new_sha)
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000155-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000155-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 323</span>
323:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update</span>(<span class="ruby-identifier">old_sha</span>, <span class="ruby-identifier">new_sha</span>)
324:       <span class="ruby-identifier">git</span>[<span class="ruby-identifier">sha_path</span>(<span class="ruby-identifier">old_sha</span>, <span class="ruby-identifier">new_sha</span>)] = [<span class="ruby-constant">UPDATE_MODE</span>, <span class="ruby-identifier">new_sha</span>]
325:       <span class="ruby-keyword kw">self</span>
326:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000138" class="method-detail">
        <a name="M000138"></a>

        <div class="method-heading">
          <a href="#M000138" class="method-signature">
          <span class="method-name">upstream_branch</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000138-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000138-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/repo.rb, line 197</span>
197:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">upstream_branch</span>
198:       <span class="ruby-identifier">git</span>.<span class="ruby-identifier">upstream_branch</span>
199:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>