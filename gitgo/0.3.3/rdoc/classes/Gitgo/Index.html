<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Gitgo::Index</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Gitgo::Index</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../files/lib/gitgo/index_rb.html">
                lib/gitgo/index.rb
                </a>
        <br />
                <a href="../../files/lib/gitgo/index/idx_file_rb.html">
                lib/gitgo/index/idx_file.rb
                </a>
        <br />
                <a href="../../files/lib/gitgo/index/sha_file_rb.html">
                lib/gitgo/index/sha_file.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
<a href="Index.html">Index</a> provides an index of documents used to
expedite searches. <a href="Index.html">Index</a> structures it&#8216;s
data into a branch-specific directory structure:
</p>
<pre>
  .git/gitgo/refs/[branch]/index
  |- filter
  |  `- key
  |     `- value
  |
  |- head
  |- list
  `- graph_map
</pre>
<p>
The files contain the following data (in conceptual order):
</p>
<pre>
  head      The user commit sha at which the last reindex occured.
  list      A list of H* packed shas representing all of the documents
            accessible by the gitgo branch. The index (idx) of the sha in
            list serves as an identifier for the sha in map and filters.
  map       A list of L* packed idx pairs mapping a document to its graph
            head.
  [value]   A list of L* packed idx that match the key-value pair. These
            lists act as filters in searches.
</pre>
<p>
The packing format for each of the index files was chosen for performance;
both to minimize the footprint of the file and optimize the usage of the
file data.
</p>
<h2>Usage</h2>
<p>
<a href="Index.html">Index</a> files are used primarily to <a
href="Index.html#M000282">select</a> documents based on various filters.
For example, to <a href="Index.html#M000282">select</a> the shas for <a
href="Index.html#M000278">all</a> comments tagged as
&#8216;important&#8217; you would do this:
</p>
<pre>
  index = Index.new('path')

  comment   = index['type']['comment']
  important = index['tag']['important']
  selected  = comment &amp; important

  heads = selected.collect {|id| idx.map[id] }
  shas  = heads.collect {|id| idx.list[id] }.uniq
</pre>
<p>
The array operations are very quick because the filters are composed of
integers, as is the <a href="Index.html#M000265">map</a>. The final step
resolves the integers to shas, but this too is simply an array lookup. The
<a href="Index.html#M000282">select</a> method encapsulates this logic:
</p>
<pre>
  shas = index.select(
    :all =&gt; {'type' =&gt; 'comment', 'tag' =&gt; 'important'},
    :map =&gt; true,
    :shas =&gt; true
  )
</pre>
<p>
Importantly, any of the index files can contain duplication without
affecting the results of <a href="Index.html#M000282">select</a>; this
allows <a href="Index.html#M000263">new</a> documents to be quickly added
into a filter or appended to list/map. As needed or convenient, the index
can <a href="Index.html#M000283">compact</a> itself and remove duplication.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000268">[]</a>&nbsp;&nbsp;
      <a href="#M000278">all</a>&nbsp;&nbsp;
      <a href="#M000271">assoc</a>&nbsp;&nbsp;
      <a href="#M000286">clear</a>&nbsp;&nbsp;
      <a href="#M000283">compact</a>&nbsp;&nbsp;
      <a href="#M000272">create</a>&nbsp;&nbsp;
      <a href="#M000275">delete</a>&nbsp;&nbsp;
      <a href="#M000279">each_idx</a>&nbsp;&nbsp;
      <a href="#M000280">each_sha</a>&nbsp;&nbsp;
      <a href="#M000270">graph_head_idx</a>&nbsp;&nbsp;
      <a href="#M000264">head</a>&nbsp;&nbsp;
      <a href="#M000269">idx</a>&nbsp;&nbsp;
      <a href="#M000281">join</a>&nbsp;&nbsp;
      <a href="#M000276">keys</a>&nbsp;&nbsp;
      <a href="#M000273">link</a>&nbsp;&nbsp;
      <a href="#M000266">list</a>&nbsp;&nbsp;
      <a href="#M000265">map</a>&nbsp;&nbsp;
      <a href="#M000263">new</a>&nbsp;&nbsp;
      <a href="#M000267">path</a>&nbsp;&nbsp;
      <a href="#M000285">reset</a>&nbsp;&nbsp;
      <a href="#M000282">select</a>&nbsp;&nbsp;
      <a href="#M000274">update</a>&nbsp;&nbsp;
      <a href="#M000277">values</a>&nbsp;&nbsp;
      <a href="#M000284">write</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">

    <div id="class-list">
      <h3 class="section-bar">Classes and Modules</h3>

      Class <a href="Index/IdxFile.html" class="link">Gitgo::Index::IdxFile</a><br />
Class <a href="Index/ShaFile.html" class="link">Gitgo::Index::ShaFile</a><br />

    </div>

    <div id="constants-list">
      <h3 class="section-bar">Constants</h3>

      <div class="name-list">
        <table summary="Constants">
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">HEAD</td>
          <td>=</td>
          <td class="context-item-value">'head'</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
A file containing the ref at which the last index was performed; used to
determine when a reindex is required relative to some other ref.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">MAP</td>
          <td>=</td>
          <td class="context-item-value">'map'</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
An <a href="Index.html#M000269">idx</a> file mapping shas to their graph
heads

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">LIST</td>
          <td>=</td>
          <td class="context-item-value">'list'</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
A sha file listing indexed shas; the index of the sha is used as an
identifer for the sha in <a href="Index.html#M000278">all</a> <a
href="Index.html#M000269">idx</a> files.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">FILTER</td>
          <td>=</td>
          <td class="context-item-value">'filter'</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
The filter directory

</td>
        </tr>
        </table>
      </div>
    </div>



    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">cache</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
Returns an in-memory, self-filling cache of <a
href="Index.html#M000269">idx</a> files

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">head_file</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
The <a href="Index.html#M000264">head</a> file for self

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">list_file</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
The <a href="Index.html#M000266">list</a> file for self

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">map_file</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
The <a href="Index.html#M000265">map</a> file for self

</td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000263" class="method-detail">
        <a name="M000263"></a>

        <div class="method-heading">
          <a href="#M000263" class="method-signature">
          <span class="method-name">new</span><span class="method-args">(path)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000263-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000263-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/index.rb, line 97</span>
 97:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">path</span>)
 98:       <span class="ruby-ivar">@path</span> = <span class="ruby-identifier">path</span>
 99:       <span class="ruby-ivar">@head_file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-constant">HEAD</span>, <span class="ruby-identifier">path</span>)
100:       <span class="ruby-ivar">@map_file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-constant">MAP</span>, <span class="ruby-identifier">path</span>)
101:       <span class="ruby-ivar">@list_file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-constant">LIST</span>, <span class="ruby-identifier">path</span>)
102:       
103:       <span class="ruby-ivar">@cache</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key_hash</span>, <span class="ruby-identifier">key</span><span class="ruby-operator">|</span>
104:         <span class="ruby-identifier">key_hash</span>[<span class="ruby-identifier">key</span>] = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value_hash</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
105:           <span class="ruby-identifier">value_hash</span>[<span class="ruby-identifier">value</span>] = <span class="ruby-keyword kw">begin</span>
106:             <span class="ruby-identifier">index</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">path</span>(<span class="ruby-constant">FILTER</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span>)
107:             <span class="ruby-constant">File</span>.<span class="ruby-identifier">file?</span>(<span class="ruby-identifier">index</span>) <span class="ruby-operator">?</span> <span class="ruby-constant">IdxFile</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">index</span>) <span class="ruby-operator">:</span> []
108:           <span class="ruby-keyword kw">end</span>
109:         <span class="ruby-keyword kw">end</span>
110:       <span class="ruby-keyword kw">end</span>
111:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000268" class="method-detail">
        <a name="M000268"></a>

        <div class="method-heading">
          <a href="#M000268" class="method-signature">
          <span class="method-name">[]</span><span class="method-args">(key)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns cache[key], a self-filling hash of filter <a
href="Index.html#M000277">values</a>. Be careful not to modify index[k][v]
as it is the actual cache storage.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000268-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000268-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/index.rb, line 138</span>
138:     <span class="ruby-keyword kw">def</span> <span class="ruby-operator">[]</span>(<span class="ruby-identifier">key</span>)
139:       <span class="ruby-identifier">cache</span>[<span class="ruby-identifier">key</span>]
140:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000278" class="method-detail">
        <a name="M000278"></a>

        <div class="method-heading">
          <a href="#M000278" class="method-signature">
          <span class="method-name">all</span><span class="method-args">(*keys)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000278-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000278-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/index.rb, line 226</span>
226:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">all</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">keys</span>)
227:       <span class="ruby-identifier">results</span> = []
228:       <span class="ruby-identifier">keys</span>.<span class="ruby-identifier">collect</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span>
229:         <span class="ruby-identifier">values</span>(<span class="ruby-identifier">key</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
230:           <span class="ruby-identifier">results</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">cache</span>[<span class="ruby-identifier">key</span>][<span class="ruby-identifier">value</span>])
231:         <span class="ruby-keyword kw">end</span>
232:       <span class="ruby-keyword kw">end</span>
233:       <span class="ruby-identifier">results</span>.<span class="ruby-identifier">uniq!</span>
234:       <span class="ruby-identifier">results</span>
235:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000271" class="method-detail">
        <a name="M000271"></a>

        <div class="method-heading">
          <a href="#M000271" class="method-signature">
          <span class="method-name">assoc</span><span class="method-args">(source, target, type)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000271-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000271-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/index.rb, line 162</span>
162:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">assoc</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">target</span>, <span class="ruby-identifier">type</span>)
163:       <span class="ruby-identifier">source_idx</span> = <span class="ruby-identifier">idx</span>(<span class="ruby-identifier">source</span>)
164:       <span class="ruby-identifier">target_idx</span> = <span class="ruby-identifier">idx</span>(<span class="ruby-identifier">target</span>)
165:       <span class="ruby-identifier">map</span>[<span class="ruby-identifier">target_idx</span>] = <span class="ruby-identifier">source_idx</span>
166:       <span class="ruby-identifier">tail_filter</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">source_idx</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:create</span>
167:       <span class="ruby-identifier">delete_filter</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">source_idx</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:delete</span>
168:       <span class="ruby-keyword kw">self</span>
169:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000286" class="method-detail">
        <a name="M000286"></a>

        <div class="method-heading">
          <a href="#M000286" class="method-signature">
          <span class="method-name">clear</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Clears <a href="Index.html#M000278">all</a> index files, and the cache.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000286-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000286-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/index.rb, line 345</span>
345:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">clear</span>
346:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">path</span>)
347:         <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_r</span>(<span class="ruby-identifier">path</span>)
348:       <span class="ruby-keyword kw">end</span>
349:       <span class="ruby-identifier">reset</span>
350:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000283" class="method-detail">
        <a name="M000283"></a>

        <div class="method-heading">
          <a href="#M000283" class="method-signature">
          <span class="method-name">compact</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000283-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000283-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/index.rb, line 290</span>
290:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">compact</span>
291:       <span class="ruby-comment cmt"># reindex shas in list, and create an idx map for updating idxs</span>
292:       <span class="ruby-identifier">old_list</span> = {}
293:       <span class="ruby-identifier">list</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">sha</span><span class="ruby-operator">|</span> <span class="ruby-identifier">old_list</span>[<span class="ruby-identifier">old_list</span>.<span class="ruby-identifier">length</span>] = <span class="ruby-identifier">sha</span> }
294:       
295:       <span class="ruby-identifier">list</span>.<span class="ruby-identifier">uniq!</span>
296:       
297:       <span class="ruby-identifier">new_list</span> = {}
298:       <span class="ruby-identifier">list</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">sha</span><span class="ruby-operator">|</span> <span class="ruby-identifier">new_list</span>[<span class="ruby-identifier">sha</span>] = <span class="ruby-identifier">new_list</span>.<span class="ruby-identifier">length</span>}
299:       
300:       <span class="ruby-identifier">idx_map</span> = {}
301:       <span class="ruby-identifier">old_list</span>.<span class="ruby-identifier">each_pair</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">idx</span>, <span class="ruby-identifier">sha</span><span class="ruby-operator">|</span> <span class="ruby-identifier">idx_map</span>[<span class="ruby-identifier">idx</span>] = <span class="ruby-identifier">new_list</span>[<span class="ruby-identifier">sha</span>]}
302:       
303:       <span class="ruby-comment cmt"># update/deconvolute mapped idx values</span>
304:       <span class="ruby-identifier">new_map</span> = {}
305:       <span class="ruby-identifier">map</span>.<span class="ruby-identifier">each_pair</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">idx</span>, <span class="ruby-identifier">head_idx</span><span class="ruby-operator">|</span> <span class="ruby-identifier">new_map</span>[<span class="ruby-identifier">idx_map</span>[<span class="ruby-identifier">idx</span>]] = <span class="ruby-identifier">idx_map</span>[<span class="ruby-identifier">head_idx</span>] }
306:       <span class="ruby-identifier">new_map</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">idx</span><span class="ruby-operator">|</span> <span class="ruby-identifier">new_map</span>[<span class="ruby-identifier">idx</span>] = <span class="ruby-identifier">deconvolute</span>(<span class="ruby-identifier">idx</span>, <span class="ruby-identifier">new_map</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">idx</span> }
307:       
308:       <span class="ruby-ivar">@map</span> = <span class="ruby-identifier">new_map</span>
309:       
310:       <span class="ruby-comment cmt"># update filter values</span>
311:       <span class="ruby-ivar">@cache</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value_hash</span><span class="ruby-operator">|</span>
312:         <span class="ruby-identifier">value_hash</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">idxs</span><span class="ruby-operator">|</span>
313:           <span class="ruby-identifier">idxs</span>.<span class="ruby-identifier">collect!</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">idx</span><span class="ruby-operator">|</span> <span class="ruby-identifier">idx_map</span>[<span class="ruby-identifier">idx</span>] }.<span class="ruby-identifier">uniq!</span>
314:         <span class="ruby-keyword kw">end</span>
315:       <span class="ruby-keyword kw">end</span>
316:       
317:       <span class="ruby-keyword kw">self</span>
318:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000272" class="method-detail">
        <a name="M000272"></a>

        <div class="method-heading">
          <a href="#M000272" class="method-signature">
          <span class="method-name">create</span><span class="method-args">(source)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000272-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000272-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/index.rb, line 171</span>
171:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create</span>(<span class="ruby-identifier">source</span>)
172:       <span class="ruby-identifier">source_idx</span> = <span class="ruby-identifier">idx</span>(<span class="ruby-identifier">source</span>)
173: 
174:       <span class="ruby-identifier">head_idx</span> = <span class="ruby-identifier">graph_head_idx</span>(<span class="ruby-identifier">source_idx</span>)
175:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">head_idx</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">head_idx</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">source_idx</span>
176:         <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;create graph fail: #{source} (already associated with graph #{list[head_idx]})&quot;</span>
177:       <span class="ruby-keyword kw">end</span>
178: 
179:       <span class="ruby-identifier">map</span>[<span class="ruby-identifier">source_idx</span>] = <span class="ruby-identifier">source_idx</span>
180:       <span class="ruby-keyword kw">self</span>
181:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000275" class="method-detail">
        <a name="M000275"></a>

        <div class="method-heading">
          <a href="#M000275" class="method-signature">
          <span class="method-name">delete</span><span class="method-args">(source)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000275-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000275-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/index.rb, line 191</span>
191:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete</span>(<span class="ruby-identifier">source</span>)
192:       <span class="ruby-identifier">source_idx</span> = <span class="ruby-identifier">idx</span>(<span class="ruby-identifier">source</span>)
193:       <span class="ruby-identifier">tail_filter</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">source_idx</span>
194:       <span class="ruby-identifier">delete_filter</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">source_idx</span>
195:       <span class="ruby-keyword kw">self</span>
196:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000279" class="method-detail">
        <a name="M000279"></a>

        <div class="method-heading">
          <a href="#M000279" class="method-signature">
          <span class="method-name">each_idx</span><span class="method-args">(key, values) {|idx| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000279-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000279-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/index.rb, line 237</span>
237:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each_idx</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">values</span>)
238:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">values</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:each</span>)
239:         <span class="ruby-identifier">values</span> = [<span class="ruby-identifier">values</span>]
240:       <span class="ruby-keyword kw">end</span>
241:       
242:       <span class="ruby-identifier">values</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
243:         <span class="ruby-identifier">cache</span>[<span class="ruby-identifier">key</span>][<span class="ruby-identifier">value</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">idx</span><span class="ruby-operator">|</span>
244:           <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">idx</span>
245:         <span class="ruby-keyword kw">end</span>
246:       <span class="ruby-keyword kw">end</span>
247:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000280" class="method-detail">
        <a name="M000280"></a>

        <div class="method-heading">
          <a href="#M000280" class="method-signature">
          <span class="method-name">each_sha</span><span class="method-args">(key, values, filter=delete_filter) {|list[idx]| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000280-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000280-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/index.rb, line 249</span>
249:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each_sha</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">values</span>, <span class="ruby-identifier">filter</span>=<span class="ruby-identifier">delete_filter</span>)
250:       <span class="ruby-identifier">each_idx</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">values</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">idx</span><span class="ruby-operator">|</span>
251:         <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">filter</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">idx</span>)
252:         <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">list</span>[<span class="ruby-identifier">idx</span>]
253:       <span class="ruby-keyword kw">end</span>
254:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000270" class="method-detail">
        <a name="M000270"></a>

        <div class="method-heading">
          <a href="#M000270" class="method-signature">
          <span class="method-name">graph_head_idx</span><span class="method-args">(idx)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Return the graph <a href="Index.html#M000264">head</a> <a
href="Index.html#M000269">idx</a> for the specified <a
href="Index.html#M000269">idx</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000270-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000270-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/index.rb, line 158</span>
158:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">graph_head_idx</span>(<span class="ruby-identifier">idx</span>)
159:       <span class="ruby-identifier">deconvolute</span>(<span class="ruby-identifier">idx</span>, <span class="ruby-identifier">map</span>)
160:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000264" class="method-detail">
        <a name="M000264"></a>

        <div class="method-heading">
          <a href="#M000264" class="method-signature">
          <span class="method-name">head</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the sha in the head_file, if it exists, and nil otherwise.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000264-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000264-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/index.rb, line 114</span>
114:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">head</span>
115:       <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">head_file</span>) <span class="ruby-operator">?</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">head_file</span>) {<span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span> <span class="ruby-identifier">io</span>.<span class="ruby-identifier">read</span>(<span class="ruby-value">40</span>) } <span class="ruby-operator">:</span> <span class="ruby-keyword kw">nil</span>
116:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000269" class="method-detail">
        <a name="M000269"></a>

        <div class="method-heading">
          <a href="#M000269" class="method-signature">
          <span class="method-name">idx</span><span class="method-args">(sha)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the <a href="Index.html#M000269">idx</a> for sha, as specified in
<a href="Index.html#M000266">list</a>. If the sha is not in <a
href="Index.html#M000266">list</a> then it is appended to <a
href="Index.html#M000266">list</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000269-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000269-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/index.rb, line 144</span>
144:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">idx</span>(<span class="ruby-identifier">sha</span>)
145:       <span class="ruby-keyword kw">case</span>
146:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">list</span>[<span class="ruby-value">-1</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">sha</span>
147:         <span class="ruby-identifier">list</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>
148:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">idx</span> = <span class="ruby-identifier">list</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">sha</span>)
149:         <span class="ruby-identifier">idx</span>
150:       <span class="ruby-keyword kw">else</span>
151:         <span class="ruby-identifier">idx</span> = <span class="ruby-identifier">list</span>.<span class="ruby-identifier">length</span>
152:         <span class="ruby-identifier">list</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">sha</span>
153:         <span class="ruby-identifier">idx</span>
154:       <span class="ruby-keyword kw">end</span>
155:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000281" class="method-detail">
        <a name="M000281"></a>

        <div class="method-heading">
          <a href="#M000281" class="method-signature">
          <span class="method-name">join</span><span class="method-args">(key, *values)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000281-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000281-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/index.rb, line 256</span>
256:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">join</span>(<span class="ruby-identifier">key</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">values</span>)
257:       <span class="ruby-identifier">values</span>.<span class="ruby-identifier">collect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span> <span class="ruby-identifier">cache</span>[<span class="ruby-identifier">key</span>][<span class="ruby-identifier">value</span>] }.<span class="ruby-identifier">flatten</span>
258:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000276" class="method-detail">
        <a name="M000276"></a>

        <div class="method-heading">
          <a href="#M000276" class="method-signature">
          <span class="method-name">keys</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns a <a href="Index.html#M000266">list</a> of possible index <a
href="Index.html#M000276">keys</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000276-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000276-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/index.rb, line 199</span>
199:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">keys</span>
200:       <span class="ruby-identifier">keys</span> = <span class="ruby-identifier">cache</span>.<span class="ruby-identifier">keys</span>
201:       
202:       <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">path</span>(<span class="ruby-constant">FILTER</span>, <span class="ruby-value str">'*'</span>)).<span class="ruby-identifier">select</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span>
203:         <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span>(<span class="ruby-identifier">path</span>)
204:       <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span>
205:         <span class="ruby-identifier">keys</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">path</span>)
206:       <span class="ruby-keyword kw">end</span>
207:       
208:       <span class="ruby-identifier">keys</span>.<span class="ruby-identifier">uniq!</span>
209:       <span class="ruby-identifier">keys</span>
210:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000273" class="method-detail">
        <a name="M000273"></a>

        <div class="method-heading">
          <a href="#M000273" class="method-signature">
          <span class="method-name">link</span><span class="method-args">(source, target)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000273-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000273-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/index.rb, line 183</span>
183:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">link</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">target</span>)
184:       <span class="ruby-identifier">associate</span> <span class="ruby-identifier">:link</span>, <span class="ruby-identifier">source</span>, <span class="ruby-identifier">target</span>
185:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000266" class="method-detail">
        <a name="M000266"></a>

        <div class="method-heading">
          <a href="#M000266" class="method-signature">
          <span class="method-name">list</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the contents of list_file, as an array.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000266-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000266-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/index.rb, line 127</span>
127:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">list</span>
128:       <span class="ruby-ivar">@list</span> <span class="ruby-operator">||=</span> (<span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">list_file</span>) <span class="ruby-operator">?</span> <span class="ruby-constant">ShaFile</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">list_file</span>) <span class="ruby-operator">:</span> [])
129:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000265" class="method-detail">
        <a name="M000265"></a>

        <div class="method-heading">
          <a href="#M000265" class="method-signature">
          <span class="method-name">map</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the contents of map_file, as a hash.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000265-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000265-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/index.rb, line 119</span>
119:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">map</span>
120:       <span class="ruby-ivar">@map</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword kw">begin</span>
121:         <span class="ruby-identifier">entries</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">map_file</span>) <span class="ruby-operator">?</span> <span class="ruby-constant">IdxFile</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">map_file</span>) <span class="ruby-operator">:</span> []
122:         <span class="ruby-constant">Hash</span>[<span class="ruby-operator">*</span><span class="ruby-identifier">entries</span>]
123:       <span class="ruby-keyword kw">end</span>
124:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000267" class="method-detail">
        <a name="M000267"></a>

        <div class="method-heading">
          <a href="#M000267" class="method-signature">
          <span class="method-name">path</span><span class="method-args">(*segments)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the segments joined to the <a href="Index.html#M000267">path</a>
used to initialize self.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000267-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000267-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/index.rb, line 132</span>
132:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">path</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">segments</span>)
133:       <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@path</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">segments</span>)
134:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000285" class="method-detail">
        <a name="M000285"></a>

        <div class="method-heading">
          <a href="#M000285" class="method-signature">
          <span class="method-name">reset</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Clears the cache.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000285-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000285-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/index.rb, line 337</span>
337:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reset</span>
338:       <span class="ruby-ivar">@list</span> = <span class="ruby-keyword kw">nil</span>
339:       <span class="ruby-ivar">@map</span> = <span class="ruby-keyword kw">nil</span>
340:       <span class="ruby-ivar">@cache</span>.<span class="ruby-identifier">clear</span>
341:       <span class="ruby-keyword kw">self</span>
342:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000282" class="method-detail">
        <a name="M000282"></a>

        <div class="method-heading">
          <a href="#M000282" class="method-signature">
          <span class="method-name">select</span><span class="method-args">(options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000282-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000282-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/index.rb, line 260</span>
260:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">select</span>(<span class="ruby-identifier">options</span>={})
261:       <span class="ruby-identifier">basis</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:basis</span>] <span class="ruby-operator">||</span> (<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-identifier">list</span>.<span class="ruby-identifier">length</span>).<span class="ruby-identifier">to_a</span>
262:       
263:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">all</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:all</span>]
264:         <span class="ruby-identifier">each_pair</span>(<span class="ruby-identifier">all</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
265:           <span class="ruby-identifier">basis</span> = <span class="ruby-identifier">basis</span> <span class="ruby-operator">&amp;</span> <span class="ruby-identifier">cache</span>[<span class="ruby-identifier">key</span>][<span class="ruby-identifier">value</span>]
266:           <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">basis</span>.<span class="ruby-identifier">empty?</span>
267:         <span class="ruby-keyword kw">end</span>
268:       <span class="ruby-keyword kw">end</span>
269:       
270:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">any</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:any</span>]
271:         <span class="ruby-identifier">matches</span> = []
272:         <span class="ruby-identifier">each_pair</span>(<span class="ruby-identifier">any</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
273:           <span class="ruby-identifier">matches</span>.<span class="ruby-identifier">concat</span> <span class="ruby-identifier">cache</span>[<span class="ruby-identifier">key</span>][<span class="ruby-identifier">value</span>]
274:         <span class="ruby-keyword kw">end</span>
275:         <span class="ruby-identifier">basis</span> = <span class="ruby-identifier">basis</span> <span class="ruby-operator">&amp;</span> <span class="ruby-identifier">matches</span>
276:       <span class="ruby-keyword kw">end</span>
277:       
278:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:map</span>]
279:         <span class="ruby-identifier">basis</span>.<span class="ruby-identifier">collect!</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">idx</span><span class="ruby-operator">|</span> <span class="ruby-identifier">map</span>[<span class="ruby-identifier">idx</span>] }
280:       <span class="ruby-keyword kw">end</span>
281:       
282:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:shas</span>]
283:         <span class="ruby-identifier">basis</span>.<span class="ruby-identifier">collect!</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">idx</span><span class="ruby-operator">|</span> <span class="ruby-identifier">list</span>[<span class="ruby-identifier">idx</span>] }
284:       <span class="ruby-keyword kw">end</span>
285:       
286:       <span class="ruby-identifier">basis</span>.<span class="ruby-identifier">uniq!</span>
287:       <span class="ruby-identifier">basis</span>
288:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000274" class="method-detail">
        <a name="M000274"></a>

        <div class="method-heading">
          <a href="#M000274" class="method-signature">
          <span class="method-name">update</span><span class="method-args">(source, target)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000274-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000274-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/index.rb, line 187</span>
187:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">target</span>)
188:       <span class="ruby-identifier">associate</span> <span class="ruby-identifier">:update</span>, <span class="ruby-identifier">source</span>, <span class="ruby-identifier">target</span>
189:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000277" class="method-detail">
        <a name="M000277"></a>

        <div class="method-heading">
          <a href="#M000277" class="method-signature">
          <span class="method-name">values</span><span class="method-args">(key)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns a <a href="Index.html#M000266">list</a> of possible <a
href="Index.html#M000277">values</a> for the specified index key.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000277-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000277-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/index.rb, line 213</span>
213:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">values</span>(<span class="ruby-identifier">key</span>)
214:       <span class="ruby-identifier">values</span> = <span class="ruby-identifier">cache</span>[<span class="ruby-identifier">key</span>].<span class="ruby-identifier">keys</span>
215:       
216:       <span class="ruby-identifier">base</span>  = <span class="ruby-identifier">path</span>(<span class="ruby-constant">FILTER</span>, <span class="ruby-identifier">key</span>)
217:       <span class="ruby-identifier">start</span> = <span class="ruby-identifier">base</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
218:       <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span class="ruby-node">&quot;#{base}/**/*&quot;</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value_path</span><span class="ruby-operator">|</span>
219:         <span class="ruby-identifier">values</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">value_path</span>[<span class="ruby-identifier">start</span>, <span class="ruby-identifier">value_path</span>.<span class="ruby-identifier">length</span><span class="ruby-operator">-</span><span class="ruby-identifier">start</span>]
220:       <span class="ruby-keyword kw">end</span>
221:       
222:       <span class="ruby-identifier">values</span>.<span class="ruby-identifier">uniq!</span>
223:       <span class="ruby-identifier">values</span>
224:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000284" class="method-detail">
        <a name="M000284"></a>

        <div class="method-heading">
          <a href="#M000284" class="method-signature">
          <span class="method-name">write</span><span class="method-args">(sha=nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Writes cached changes.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000284-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000284-source">
<pre>
     <span class="ruby-comment cmt"># File lib/gitgo/index.rb, line 321</span>
321:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">write</span>(<span class="ruby-identifier">sha</span>=<span class="ruby-keyword kw">nil</span>)
322:       <span class="ruby-ivar">@cache</span>.<span class="ruby-identifier">each_pair</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">value_hash</span><span class="ruby-operator">|</span>
323:         <span class="ruby-identifier">value_hash</span>.<span class="ruby-identifier">each_pair</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span>, <span class="ruby-identifier">idx</span><span class="ruby-operator">|</span>
324:           <span class="ruby-constant">IdxFile</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">path</span>(<span class="ruby-constant">FILTER</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span>), <span class="ruby-identifier">idx</span>)
325:         <span class="ruby-keyword kw">end</span>
326:       <span class="ruby-keyword kw">end</span>
327:       
328:       <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span>(<span class="ruby-identifier">path</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">path</span>)
329:       <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">head_file</span>, <span class="ruby-value str">&quot;w&quot;</span>) {<span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span> <span class="ruby-identifier">io</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">sha</span>) } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sha</span>
330:       <span class="ruby-constant">ShaFile</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">list_file</span>, <span class="ruby-identifier">list</span>.<span class="ruby-identifier">join</span>)
331:       <span class="ruby-constant">IdxFile</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">map_file</span>, <span class="ruby-identifier">map</span>.<span class="ruby-identifier">to_a</span>.<span class="ruby-identifier">flatten</span>)
332:       
333:       <span class="ruby-keyword kw">self</span>
334:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>