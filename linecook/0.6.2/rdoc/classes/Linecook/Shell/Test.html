<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Module: Linecook::Shell::Test</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Module</strong></td>
          <td class="class-name-in-header">Linecook::Shell::Test</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../../files/lib/linecook/shell/test_rb.html">
                lib/linecook/shell/test.rb
                </a>
        <br />
            </td>
        </tr>

        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
A module for testing shell scripts.
</p>
<pre>
  class ShellTestSample &lt; Test::Unit::TestCase
    include Linecook::Test::Shell

    # these are the default sh_test options used
    # in tests like test_sh_command_alias
    self.sh_test_options = {
      :cmd_pattern =&gt; '% inspect_argv',
      :cmd =&gt; 'ruby -e &quot;puts ARGV.inspect&quot;'
    }

    def test_echo
      assert_equal &quot;goodnight moon&quot;, sh(&quot;echo goodnight moon&quot;).strip
    end

    def test_echo_using_sh_test
      sh_test %q{
  echo goodnight moon
  goodnight moon
  }
    end

    def test_sh_command_alias
      sh_test(&quot;% inspect_env&quot;) do |output|
        assert output !~ /NEW_ENV_VAR/
      end

      sh_test(&quot;NEW_ENV_VAR=blue % inspect_env&quot;) do |output|
        assert output =~ /NEW_ENV_VAR=blue/
      end
    end
  end
</pre>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000011">quiet?</a>&nbsp;&nbsp;
      <a href="#M000008">set_env</a>&nbsp;&nbsp;
      <a href="#M000007">setup</a>&nbsp;&nbsp;
      <a href="#M000012">sh</a>&nbsp;&nbsp;
      <a href="#M000014">sh_match</a>&nbsp;&nbsp;
      <a href="#M000013">sh_test</a>&nbsp;&nbsp;
      <a href="#M000015">sh_test_options</a>&nbsp;&nbsp;
      <a href="#M000010">verbose?</a>&nbsp;&nbsp;
      <a href="#M000009">with_env</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->
    <div id="includes">
      <h3 class="section-bar">Included Modules</h3>

      <div id="includes-list">
        <span class="include-name"><a href="../Test.html">Linecook::Test</a></span>
      </div>
    </div>

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000011" class="method-detail">
        <a name="M000011"></a>

        <div class="method-heading">
          <a href="#M000011" class="method-signature">
          <span class="method-name">quiet?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns true if the ENV variable &#8216;QUIET&#8217; is true or nil. If
&#8216;VERBOSE&#8217; and &#8216;QUIET&#8217; are both set, verbose wins.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000011-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000011-source">
<pre>
    <span class="ruby-comment cmt"># File lib/linecook/shell/test.rb, line 94</span>
94:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">quiet?</span>
95:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">verbose?</span>
96: 
97:         <span class="ruby-identifier">quiet</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'QUIET'</span>]
98:         <span class="ruby-identifier">quiet</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">quiet</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^true$/i</span> <span class="ruby-operator">?</span> <span class="ruby-keyword kw">true</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">false</span>
99:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000008" class="method-detail">
        <a name="M000008"></a>

        <div class="method-heading">
          <a href="#M000008" class="method-signature">
          <span class="method-name">set_env</span><span class="method-args">(env={}, replace=false)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets the specified ENV variables and returns the <b>current</b> env. If
replace is true, current ENV variables are replaced; otherwise the new env
variables are simply added to the existing set.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000008-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000008-source">
<pre>
    <span class="ruby-comment cmt"># File lib/linecook/shell/test.rb, line 50</span>
50:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_env</span>(<span class="ruby-identifier">env</span>={}, <span class="ruby-identifier">replace</span>=<span class="ruby-keyword kw">false</span>)
51:         <span class="ruby-identifier">current_env</span> = {}
52:         <span class="ruby-constant">ENV</span>.<span class="ruby-identifier">each_pair</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
53:           <span class="ruby-identifier">current_env</span>[<span class="ruby-identifier">key</span>] = <span class="ruby-identifier">value</span>
54:         <span class="ruby-keyword kw">end</span>
55: 
56:         <span class="ruby-constant">ENV</span>.<span class="ruby-identifier">clear</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">replace</span>
57: 
58:         <span class="ruby-identifier">env</span>.<span class="ruby-identifier">each_pair</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
59:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">nil?</span>
60:             <span class="ruby-constant">ENV</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">key</span>)
61:           <span class="ruby-keyword kw">else</span>
62:             <span class="ruby-constant">ENV</span>[<span class="ruby-identifier">key</span>] = <span class="ruby-identifier">value</span>
63:           <span class="ruby-keyword kw">end</span>
64:         <span class="ruby-keyword kw">end</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">env</span>
65: 
66:         <span class="ruby-identifier">current_env</span>
67:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000007" class="method-detail">
        <a name="M000007"></a>

        <div class="method-heading">
          <a href="#M000007" class="method-signature">
          <span class="method-name">setup</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000007-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000007-source">
<pre>
    <span class="ruby-comment cmt"># File lib/linecook/shell/test.rb, line 42</span>
42:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">setup</span>
43:         <span class="ruby-keyword kw">super</span>
44:         <span class="ruby-ivar">@notify_method_name</span> = <span class="ruby-keyword kw">true</span>
45:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000012" class="method-detail">
        <a name="M000012"></a>

        <div class="method-heading">
          <a href="#M000012" class="method-signature">
          <span class="method-name">sh</span><span class="method-args">(cmd, options={}) {|io| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Executes the command using IO.popen and returns the stdout content.
</p>
<h4>Note</h4>
<p>
On Windows this method requires the <a
href="http://rubyforge.org/projects/win32utils">win32-popen3</a> utility.
If it is not available, it will have to be installed:
</p>
<pre>
  % gem install win32-open3
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000012-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000012-source">
<pre>
     <span class="ruby-comment cmt"># File lib/linecook/shell/test.rb, line 109</span>
109:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sh</span>(<span class="ruby-identifier">cmd</span>, <span class="ruby-identifier">options</span>={})
110:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@notify_method_name</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">quiet?</span>
111:           <span class="ruby-ivar">@notify_method_name</span> = <span class="ruby-keyword kw">false</span>
112:           <span class="ruby-identifier">puts</span>
113:           <span class="ruby-identifier">puts</span> <span class="ruby-identifier">method_name</span> 
114:         <span class="ruby-keyword kw">end</span>
115: 
116:         <span class="ruby-identifier">original_cmd</span> = <span class="ruby-identifier">cmd</span>
117:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cmd_pattern</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:cmd_pattern</span>]
118:           <span class="ruby-identifier">cmd</span> = <span class="ruby-identifier">cmd</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-identifier">cmd_pattern</span>, <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:cmd</span>].<span class="ruby-identifier">to_s</span>)
119:         <span class="ruby-keyword kw">end</span>
120: 
121:         <span class="ruby-identifier">start</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
122:         <span class="ruby-identifier">result</span> = <span class="ruby-identifier">with_env</span>(<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:env</span>], <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:replace_env</span>]) <span class="ruby-keyword kw">do</span>
123:           <span class="ruby-constant">IO</span>.<span class="ruby-identifier">popen</span>(<span class="ruby-identifier">cmd</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
124:             <span class="ruby-keyword kw">yield</span>(<span class="ruby-identifier">io</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
125:             <span class="ruby-identifier">io</span>.<span class="ruby-identifier">read</span>
126:           <span class="ruby-keyword kw">end</span>
127:         <span class="ruby-keyword kw">end</span>
128: 
129:         <span class="ruby-identifier">finish</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
130:         <span class="ruby-identifier">elapsed</span> = <span class="ruby-value str">&quot;%.3f&quot;</span> <span class="ruby-operator">%</span> [<span class="ruby-identifier">finish</span><span class="ruby-operator">-</span><span class="ruby-identifier">start</span>]
131:         <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;  (#{elapsed}s) #{verbose? ? cmd : original_cmd}&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">quiet?</span>
132:         <span class="ruby-identifier">result</span>
133:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000014" class="method-detail">
        <a name="M000014"></a>

        <div class="method-heading">
          <a href="#M000014" class="method-signature">
          <span class="method-name">sh_match</span><span class="method-args">(cmd, *regexps) {|result| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Similar to <a href="Test.html#M000013">sh_test</a>, but matches the output
against each of the regexps. A hash of <a href="Test.html#M000012">sh</a>
options can be provided as the last argument; it will be merged with the
default <a href="Test.html#M000015">sh_test_options</a>.
</p>
<p>
The output is yielded to the block, if given, for further validation.
Returns the <a href="Test.html#M000012">sh</a> output.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000014-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000014-source">
<pre>
     <span class="ruby-comment cmt"># File lib/linecook/shell/test.rb, line 230</span>
230:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sh_match</span>(<span class="ruby-identifier">cmd</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">regexps</span>)
231:         <span class="ruby-identifier">options</span> = <span class="ruby-identifier">regexps</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Hash</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">regexps</span>.<span class="ruby-identifier">pop</span> <span class="ruby-operator">:</span> {}
232:         <span class="ruby-identifier">options</span> = <span class="ruby-identifier">sh_test_options</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">options</span>)
233:         <span class="ruby-identifier">result</span> = <span class="ruby-identifier">sh</span>(<span class="ruby-identifier">cmd</span>, <span class="ruby-identifier">options</span>)
234: 
235:         <span class="ruby-identifier">regexps</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">regexp</span><span class="ruby-operator">|</span>
236:           <span class="ruby-identifier">assert_match</span> <span class="ruby-identifier">regexp</span>, <span class="ruby-identifier">result</span>, <span class="ruby-identifier">cmd</span>
237:         <span class="ruby-keyword kw">end</span>
238:         <span class="ruby-keyword kw">yield</span>(<span class="ruby-identifier">result</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
239:         <span class="ruby-identifier">result</span>
240:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000013" class="method-detail">
        <a name="M000013"></a>

        <div class="method-heading">
          <a href="#M000013" class="method-signature">
          <span class="method-name">sh_test</span><span class="method-args">(cmd, options={}) {|result| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Peforms a shell test. <a href="../Shell.html">Shell</a> tests execute the
command and yield the $stdout result to the block for validation. The
command is executed through <a href="Test.html#M000012">sh</a>, ie using
IO.popen.
</p>
<p>
Options provided to <a href="Test.html#M000013">sh_test</a> are merged with
the <a href="Test.html#M000015">sh_test_options</a> set for the class.
</p>
<h4>Command Aliases</h4>
<p>
The options allow specification of a command pattern that gets replaced
with a command alias. Only the first instance of the command pattern is
replaced. In addition, shell tests allow the expected result to be
specified inline with the command. Used together, these allow multiple
tests of a complex command to be specified easily:
</p>
<pre>
  opts = {
    :cmd_pattern =&gt; '% argv_inspect',
    :cmd =&gt; 'ruby -e &quot;puts ARGV.inspect&quot;'
  }

  sh_test %Q{
  % argv_inspect goodnight moon
  [&quot;goodnight&quot;, &quot;moon&quot;]
  }, opts

  sh_test %Q{
  % argv_inspect hello world
  [&quot;hello&quot;, &quot;world&quot;]
  }, opts
</pre>
<h4>Indents</h4>
<p>
To improve the readability of tests, <a
href="Test.html#M000013">sh_test</a> will lstrip each line in the expected
output to the same degree as the command line. So for instance these all
pass:
</p>
<pre>
  sh_test %Q{
  % argv_inspect hello world
  [&quot;hello&quot;, &quot;world&quot;]
  }, opts

  sh_test %Q{
      % argv_inspect hello world
      [&quot;hello&quot;, &quot;world&quot;]
  }, opts

      sh_test %Q{
      % argv_inspect hello world
      [&quot;hello&quot;, &quot;world&quot;]
      }, opts
</pre>
<p>
Turn off indent stripping by specifying :indent =&gt; false.
</p>
<h4>ENV variables</h4>
<p>
Options may specify a hash of env variables that will be set in the
subprocess.
</p>
<pre>
  sh_test %Q{
  ruby -e &quot;puts ENV['SAMPLE']&quot;
  value
  }, :env =&gt; {'SAMPLE' =&gt; 'value'}
</pre>
<p>
Note it is better to specify env variables in this way rather than through
the command trick &#8216;VAR=value cmd &#8230;&#8217;, as that syntax does
not work on Windows. As a point of interest, see <a
href="http://gist.github.com/107363">gist.github.com/107363</a> for a
demonstration of ENV variables being inherited by subprocesses.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000013-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000013-source">
<pre>
     <span class="ruby-comment cmt"># File lib/linecook/shell/test.rb, line 204</span>
204:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sh_test</span>(<span class="ruby-identifier">cmd</span>, <span class="ruby-identifier">options</span>={})
205:         <span class="ruby-identifier">options</span> = <span class="ruby-identifier">sh_test_options</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">options</span>)
206: 
207:         <span class="ruby-comment cmt"># strip indentiation if possible</span>
208:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cmd</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/\A(?:\s*?\n)?( *)(.*?\n)(.*)\z/</span><span class="ruby-identifier">m</span>
209:           <span class="ruby-identifier">indent</span>, <span class="ruby-identifier">cmd</span>, <span class="ruby-identifier">expected</span> = <span class="ruby-identifier">$1</span>, <span class="ruby-identifier">$2</span>, <span class="ruby-identifier">$3</span>
210:           <span class="ruby-identifier">cmd</span>.<span class="ruby-identifier">strip!</span>
211: 
212:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">indent</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:indents</span>]
213:             <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-node">/^ {0,#{indent.length}}/</span>, <span class="ruby-value str">''</span>)
214:           <span class="ruby-keyword kw">end</span>
215:         <span class="ruby-keyword kw">end</span>
216: 
217:         <span class="ruby-identifier">result</span> = <span class="ruby-identifier">sh</span>(<span class="ruby-identifier">cmd</span>, <span class="ruby-identifier">options</span>)
218: 
219:         <span class="ruby-identifier">assert_equal</span>(<span class="ruby-identifier">expected</span>, <span class="ruby-identifier">result</span>, <span class="ruby-identifier">cmd</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">expected</span>
220:         <span class="ruby-keyword kw">yield</span>(<span class="ruby-identifier">result</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
221:         <span class="ruby-identifier">result</span>
222:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000015" class="method-detail">
        <a name="M000015"></a>

        <div class="method-heading">
          <a href="#M000015" class="method-signature">
          <span class="method-name">sh_test_options</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns a hash of default <a href="Test.html#M000013">sh_test</a> options.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000015-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000015-source">
<pre>
     <span class="ruby-comment cmt"># File lib/linecook/shell/test.rb, line 243</span>
243:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sh_test_options</span>
244:         {
245:           <span class="ruby-identifier">:cmd_pattern</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'% '</span>,
246:           <span class="ruby-identifier">:cmd</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'2&gt;&amp;1 '</span>,
247:           <span class="ruby-identifier">:indents</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>,
248:           <span class="ruby-identifier">:env</span> =<span class="ruby-operator">&gt;</span> {},
249:           <span class="ruby-identifier">:replace_env</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>
250:         }
251:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000010" class="method-detail">
        <a name="M000010"></a>

        <div class="method-heading">
          <a href="#M000010" class="method-signature">
          <span class="method-name">verbose?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns true if the ENV variable &#8216;VERBOSE&#8217; is true.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000010-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000010-source">
<pre>
    <span class="ruby-comment cmt"># File lib/linecook/shell/test.rb, line 87</span>
87:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">verbose?</span>
88:         <span class="ruby-identifier">verbose</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'VERBOSE'</span>]
89:         <span class="ruby-identifier">verbose</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">verbose</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^true$/i</span> <span class="ruby-operator">?</span> <span class="ruby-keyword kw">true</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">false</span>
90:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000009" class="method-detail">
        <a name="M000009"></a>

        <div class="method-heading">
          <a href="#M000009" class="method-signature">
          <span class="method-name">with_env</span><span class="method-args">(env={}, replace=false) {|| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets the specified ENV variables for the duration of the block. If replace
is true, current ENV variables are replaced; otherwise the new env
variables are simply added to the existing set.
</p>
<p>
Returns the block return.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000009-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000009-source">
<pre>
    <span class="ruby-comment cmt"># File lib/linecook/shell/test.rb, line 74</span>
74:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">with_env</span>(<span class="ruby-identifier">env</span>={}, <span class="ruby-identifier">replace</span>=<span class="ruby-keyword kw">false</span>)
75:         <span class="ruby-identifier">current_env</span> = <span class="ruby-keyword kw">nil</span>
76:         <span class="ruby-keyword kw">begin</span>
77:           <span class="ruby-identifier">current_env</span> = <span class="ruby-identifier">set_env</span>(<span class="ruby-identifier">env</span>, <span class="ruby-identifier">replace</span>)
78:           <span class="ruby-keyword kw">yield</span>
79:         <span class="ruby-keyword kw">ensure</span>
80:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_env</span>
81:             <span class="ruby-identifier">set_env</span>(<span class="ruby-identifier">current_env</span>, <span class="ruby-keyword kw">true</span>)
82:           <span class="ruby-keyword kw">end</span>
83:         <span class="ruby-keyword kw">end</span>
84:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>