<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>File: Control Virtual Machines</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



  <div id="fileHeader">
    <h1>Control Virtual Machines</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>HowTo/Control Virtual Machines
      </td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Sun Jul 24 20:39:43 -0600 2011</td>
    </tr>
    </table>
  </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <h1>Control Virtual Machines</h1>
<p>
<a href="../../classes/Linecook.html">Linecook</a> provides these commands
to control VirtualBox VMs:
</p>
<pre>
  # ex: 'linecook start'
  start              start a vm
  stop               stop a vm
  state              print the vm state
  save               take a vm snapshop
  ssh                ssh to a vm
</pre>
<p>
Most of these commands wrap the VirtualBox command line tool VBoxManage in
very simple ways. With these commands it&#8216;s straightforward to make an
iterative script development workflow to build a server component, save the
server state, build another component, and then at any time reset and
rebuild the whole thing from scratch.
</p>
<p>
<a href="../../classes/Linecook.html">Linecook</a> uses a standard ssh
config file to run scripts; the same config file is also used to configure
the VM control commands. More details are presented in the help to <a
href="Run%20Scripts.html">run scripts</a>, but suffice these configs will
access the &#8216;abox&#8217; VM built by the <a
href="Setup%20Virtual%20Machines.html">VM Setup procedure</a>:
</p>
<pre>
  [config/ssh]
  Host abox
  HostName localhost
  User linecook
  Port 2220
</pre>
<p>
Now you can control the VM like this:
</p>
<pre>
  # start the VM, resetting to a snapshot
  linecook start --snapshot base

  # ssh to the VM
  linecook ssh

  # take a snapshot
  linecook snapshot modified

  # reset a snapshot, removing all children
  linecook snapshot --reset base

  # stop the VM and go home
  linecook stop
</pre>
<h2>Multiple VMs</h2>
<p>
To control multiple VMs, build and configure ssh access to each. For
example make a &#8216;bbox&#8217; VM as before but configure ssh access on
port 2221:
</p>
<pre>
  - name: bbox
  - hostname: bbox-ubuntu
  VBoxManage modifyvm bbox --natpf1 'bbox-ssh,tcp,,2221,,22'
</pre>
<p>
Now add an entry for bbox in the ssh config file (note the * Host can be
used to declare default settings):
</p>
<pre>
  [config/ssh]
  Host abox
  Port 2220

  Host bbox
  Port 2221

  Host *
  HostName localhost
  User linecook
</pre>
<p>
Now same linecook commands will control both VMs:
</p>
<pre>
  # start all (or a subset) the VMs to a known snapshot
  linecook start --snapshot base
  linecook start --snapshot base abox

  # ssh to the VMs one at a time
  linecook ssh abox
  linecook ssh bbox

  # move the current snapshot forward for all (or a subset) the VMs
  linecook snapshot modified
  linecook snapshot modified abox

  # reset a snapshot, removing all children for all (or a subset) the VMs
  linecook snapshot --reset base
  linecook snapshot --reset base abox

  # stop all (or a subset) the VMs
  linecook stop
  linecook stop abox
</pre>
<h2>Host and VM Names</h2>
<p>
The Host config corresponds to the package name that will be run on the VM;
ie the &#8216;abox.yml&#8217; package goes to the &#8216;abox&#8217; Host.
Implicitly the VM will also be named &#8216;abox&#8217; in VirtualBox (such
that if you opened the VirtualBox application you&#8216;d see
&#8216;abox&#8217;). If you name it something else, then declare the actual
VM name next to the Host config using a linecook-specific comment like
this:
</p>
<pre>
  [config/ssh]
  ...
  Host abox    # [the_vm_name]
  ...
</pre>
<p>
The Host config, &#8216;abox&#8217; in this case, is the input for all
linecook commands; linecook resolves the VM name internally when
interacting with VirtualBox.
</p>

    </div>


   </div>


  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>