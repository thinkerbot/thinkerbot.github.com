<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>File: Run Scripts</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



  <div id="fileHeader">
    <h1>Run Scripts</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>HowTo/Run Scripts
      </td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Sun Jul 24 20:39:46 -0600 2011</td>
    </tr>
    </table>
  </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <h1>Run Scripts</h1>
<p>
<a href="../../classes/Linecook.html">Linecook</a> runs scripts using the
&#8216;run&#8217; command. Internally run copies scripts to a server using
scp and then executes the script using ssh. More specifically run copies a
<b>package</b> to the server and executes a script within the package using
ssh. A package is simply a directory containing scripts and any files the
scripts use.
</p>
<p>
To manually recreate what run does, make a directory with an script, copy
it, and execute as below (assuming you set up the &#8216;abox&#8217; server
<a href="../Tutorial/1%20-%20VM%20Setup.html">as described earlier</a>).
Note that the script is made executable locally such that scp will make the
script executable on the server.
</p>
<pre>
  mkdir demo
  cat &gt; demo/script.sh &lt;&lt;&quot;DOC&quot;
  echo &quot;# $(whoami)@$(hostname): hello world!&quot;
  DOC
  chmod +x demo/script.sh

  scp -r -P 2220 demo linecook@localhost:/tmp/demo
  ssh -p 2220 linecook@localhost -- &quot;/tmp/demo/script.sh&quot;
  # linecook@abox-ubuntu: hello world!
</pre>
<p>
To simplify this a little, move the redundant information used by scp and
ssh can into a standard ssh config file. <a
href="../../classes/Linecook.html">Linecook</a> looks for an ssh config
file in &#8216;config/ssh&#8217; by default:
</p>
<pre>
  mkdir config
  cat &gt; config/ssh &lt;&lt;DOC
  Host abox
  User linecook
  HostName localhost
  Port 2220
  DOC
</pre>
<p>
Now run will copy the package under the &#8216;packages&#8217; directory
with the same name as the Host config, and execute the specified script:
</p>
<pre>
  mkdir packages
  mv demo packages/abox
  linecook run --script script.sh abox
  # linecook@abox-ubuntu: hello world!
</pre>
<p>
To run multiple packages at once, simply add more hosts to the ssh config
file. Run copies each package to the appropriate host and then runs the
same script on each (in alphabetic order by host). So say you also set up a
&#8216;bbox&#8217; same as &#8216;abox&#8217;:
</p>
<pre>
  cat &gt;&gt; config/ssh &lt;&lt;DOC
  Host abox
  Port 2220

  Host bbox
  Port 2221

  Host *
  User linecook
  HostName localhost
  DOC
  cp packages/abox packages/bbox
</pre>
<p>
Then:
</p>
<pre>
  linecook run --script script.sh abox bbox
  # linecook@abox-ubuntu: hello world!
  # linecook@bbox-ubuntu: hello world!
</pre>
<p>
Note that by default run will execute the &#8216;run&#8217; script on all
hosts configured in &#8216;config/ssh&#8217;. Leveraging these defaults
simplifies the last command:
</p>
<pre>
  mv packages/abox/script.sh packages/abox/run
  mv packages/bbox/script.sh packages/bbox/run
  linecook run
  # linecook@abox-ubuntu: hello world!
  # linecook@bbox-ubuntu: hello world!
</pre>
<p>
If you&#8216;ve never used scp/ssh with a config file then this may seem
unfamiliar but hopefully quite graceful. For scp/ssh masters, these are
equivalent for each host:
</p>
<pre>
  linecook run --remote-dir=/tmp/linecook SCRIPT ARGS...

  scp -q -r -p -F config/ssh packages/host &quot;host:/tmp/linecook&quot;
  ssh -q -t -t -F config/ssh host -- &quot;/tmp/linecook/SCRIPT ARGS...&quot;
</pre>
<p>
Now that you can run scripts, onward to generating scripts!
</p>

    </div>


   </div>


  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>