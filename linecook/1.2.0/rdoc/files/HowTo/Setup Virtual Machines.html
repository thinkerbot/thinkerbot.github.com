<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>File: Setup Virtual Machines</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



  <div id="fileHeader">
    <h1>Setup Virtual Machines</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>HowTo/Setup Virtual Machines
      </td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Sun Jul 24 20:39:46 -0600 2011</td>
    </tr>
    </table>
  </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <h1>Setup Virtual Machines</h1>
<p>
<a href="http://www.virtualbox.org">VirtualBox</a> runs virtual machines on
your local box. Local VMs help minimize development cycles because they are
quick to access and reset. In addition, VirtualBox allows snapshots which
can save and restore a particular server state - this functionality enables
iterative development.
</p>
<p>
To set up a Ubuntu VM using VirtualBox:
</p>
<ol>
<li>Download and Install VirtualBox (<a
href="http://www.virtualbox.org">www.virtualbox.org</a>)

</li>
<li>Download a Ubuntu ISO (<a
href="http://www.ubuntu.com/server/get-ubuntu/download">www.ubuntu.com/server/get-ubuntu/download</a>)

</li>
<li>Build the Box

</li>
</ol>
<p>
When done, see the documentation for <a
href="Control%20Virtual%20Machines.html">controlling VMs</a>
</p>
<h2>Building a Ubuntu Box</h2>
<p>
Use the VirtualBox wizard to get started. The name and other settings (ex
user, ssh port) may be changed but be sure to propagate changes throughout
the setup process.
</p>
<pre>
  - name: abox
  - Linux/Ubuntu
  - 512 MB memory
  - 8 GB dynamically resizing drive
</pre>
<p>
Add the Ubuntu iso to the cd/dvd device under Settings &gt; Storage. Now
start the server and install Ubuntu (use default settings unless
specified):
</p>
<pre>
  - hostname: abox-ubuntu
  - user/password: linecook
  - select 'OpenSSH server' in packages to install
</pre>
<p>
When the server has rebooted and is at the login screen, remove the install
iso, take a snapshot, and setup port forwarding. Port forwarding allows you
to access the ssh port (22) on the VM via a port on your local box (2220).
</p>
<pre>
  (Devices &gt; CD/DVD Devices &gt; Remove disk from virtual drive)
  VBoxManage snapshot abox take RAW
  VBoxManage controlvm abox poweroff
  # wait to fully power off
  VBoxManage modifyvm abox --natpf1 'abox-ssh,tcp,,2220,,22'
  VBoxManage -q snapshot abox restore RAW
  VBoxManage startvm abox
</pre>
<p>
Transfer your ssh key to the VM (notice port 2220). Help to generate ssh
keys can be found on <a
href="http://help.github.com/key-setup-redirect">GitHub</a>:
</p>
<pre>
  scp -P 2220 -o UserKnownHostsFile=/dev/null ~/.ssh/id_rsa.pub linecook@localhost:id_rsa.pub
</pre>
<p>
Login as linecook and setup SSH access:
</p>
<pre>
  vm: mkdir .ssh
  vm: mv id_rsa.pub .ssh/authorized_keys
  vm: chmod 0700 .ssh
  vm: chmod 0600 .ssh/authorized_keys
</pre>
<p>
Remove the login banner (as a convenience) and exit:
</p>
<pre>
  vm: sudo rm /etc/motd
  vm: exit
</pre>
<p>
Now take a base snapshot:
</p>
<pre>
  VBoxManage snapshot abox take BASE
  VBoxManage controlvm abox poweroff
</pre>
<p>
To cleanup port forwarding (run later, if ever):
</p>
<pre>
  VBoxManage modifyvm abox --natpf1 delete 'abox-ssh'
</pre>
<p>
The same procedure can be repeated to build other VMs. Nothing is special
about this setup. The os, name, port, and other settings may be changed to
your liking - all that <a href="../../classes/Linecook.html">Linecook</a>
requires is ssh access.
</p>

    </div>


   </div>


  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>