<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>File: Switch Users</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



  <div id="fileHeader">
    <h1>Switch Users</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>HowTo/Switch Users
      </td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Sun Jul 24 20:39:37 -0600 2011</td>
    </tr>
    </table>
  </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <h1>Switch Users</h1>
<p>
The login and su methods in the <a
href="../../classes/Linebook/Os/Linux.html">Linebook::Os::Linux</a> module
both provide a way to switch users. Login simulates a login and therefore
you end up in the user home directory with the ENV as setup during login.
By contrast su switches users such that it preserves exported ENV
variables, including the pwd.
</p>
<p>
Say you were the linecook user:
</p>
<pre>
  cd
  export 'A', 'a'
  variable 'B', 'b'
  echo &quot;$(whoami):$(pwd):$A:$B&quot;             # =&gt; linecook:/home/linecook:a:b
  login { echo &quot;$(whoami):$(pwd):$A:$B&quot; }   # =&gt; root:/root::
  su    { echo &quot;$(whoami):$(pwd):$A:$B&quot; }   # =&gt; root:/home/linecook:a:
</pre>
<p>
User-management methods in this module assume root privileges (useradd,
groupadd, etc) so unless you are already root, you need to wrap them in
login or su. In this case login is more reliable than su because some
systems leave the user management commands off the non-root PATH; using
login ensures PATH will be set for root during the block.
</p>
<p>
For example use:
</p>
<pre>
  login { useradd 'username' }
</pre>
<p>
Rather than:
</p>
<pre>
  su { useradd 'username' }   # may give 'useradd: command not found'
</pre>
<h2>Permissions</h2>
<p>
The user running the package needs the ability to su without a password,
otherwise login/su will choke and fail when run by &#8216;linecook
run&#8217;. How this is accomplished is a matter of policy; something each
user needs to decide for themselves.
</p>
<p>
First you could run the package as root.
</p>
<p>
Second you can grant the running user (ex &#8216;linecook&#8217;) su
privileges. This can be accomplished by adding the user to the
&#8216;wheel&#8217; group and modifiying the PAM config files. Afterwards
all wheel users can su without a password. To do so (repeat for
&#8217;/etc/pam.d/su-l&#8217; if it exists):
</p>
<pre>
  vi /etc/pam.d/su
  # insert:
  #   auth       sufficient pam_wheel.so trust
</pre>
<p>
This is the default strategy and it works in a portable way because the <a
href="http://refspecs.linuxfoundation.org/LSB_4.1.0/LSB-Core-generic/LSB-Core-generic/su.html">linux
spec</a> requires su exists and has the necessary options.
</p>
<p>
Third you can chuck the default login/su, re-implement them with sudo, and
give the user (ex &#8216;linecook&#8217;) sudo privileges. This can be
accomplished by adding the user to a group (ex &#8216;linecook&#8217;) and
modifying the sudo config via visudo. Afterwards all the linecook users can
sudo without a password.
</p>
<pre>
  visudo
  # insert:
  #   # Members of the linecook group may sudo without a password
  #   %linecook ALL=NOPASSWD: ALL
</pre>
<p>
See an old version of the {linebook source}[<a
href="https://github.com/pinnacol/linebook/tree/b786e1e63c68f5ddf3be15851d">github.com/pinnacol/linebook/tree/b786e1e63c68f5ddf3be15851d</a>
9b423bc05e5345/helpers/linebook/os/linux] for hints on how login/su could
be reimplemented with sudo. This strategy was abandoned because sudo is not
required by the linux spec and is does not come installed in many cases (ex
Debian). Moreover the options needed to make this strategy work don&#8216;t
exist in sudo &lt; 1.7, so even systems that come with sudo could need an
upgrade.
</p>
<p>
Lastly you can chuck all of these strategies and figure out your own way.
Surely they exist, for example by running scripts manually and entering in
passwords as prompted.
</p>

    </div>


   </div>


  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>