<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Module: Lazydoc::Attributes</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Module</strong></td>
          <td class="class-name-in-header">Lazydoc::Attributes</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../files/lib/lazydoc/attributes_rb.html">
                lib/lazydoc/attributes.rb
                </a>
        <br />
            </td>
        </tr>

        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
<a href="Attributes.html">Attributes</a> adds methods to declare
class-level accessors for constant attributes associated with the class.
</p>
<pre>
  # ConstName::key value
  class ConstName
    extend Lazydoc::Attributes
    lazy_attr :key
  end

  ConstName::key.subject                 # =&gt; 'value'
</pre>
<p>
Lazy attributes are inherited, but can be overridden.
</p>
<pre>
  class SubclassA &lt; ConstName; end
  SubclassA::key.subject                 # =&gt; 'value'

  # SubclassB::key overridden value
  class SubclassB &lt; ConstName; end
  SubclassB::key.subject                 # =&gt; 'overridden value'
</pre>
<p>
You can use <a href="Attributes.html">Attributes</a> to register methods on
modules, but currently the inheritance is a bit wonky; the accessors are
methods on the <a href="Attributes.html#M000009">extended</a> class/module
and so standard module inclusion will not pass them on. To work around you
need to extend and redefine the accessors. Note, however, that methods do
not need to be re-registered.
</p>
<pre>
  module A
    extend Lazydoc::Attributes
    lazy_attr(:one, :method_one)
    lazy_register(:method_one)

    # documentation for method one
    def method_one; end
  end

  class B
    include A
    extend Lazydoc::Attributes
    lazy_attr(:one, :method_one)
  end

  class C &lt; B
    # overriding documentation for method one
    def method_one; end
  end

  A::one.comment    # =&gt; &quot;documentation for method one&quot;
  B::one.comment    # =&gt; &quot;documentation for method one&quot;
  C::one.comment    # =&gt; &quot;overriding documentation for method one&quot;
</pre>
<h4>Keys and Register</h4>
<p>
Constant attributes parsed from a source file will ALWAYS be stored in <a
href="Attributes.html#M000011">const_attrs</a> using a string (since the
&#8216;ConstName::key&#8217; syntax always results in a string key). A <a
href="Attributes.html#M000013">lazy_attr</a> is basically shorthand for
either of these statements:
</p>
<pre>
  ConstName.const_attrs['key'].subject            # =&gt; 'value'
  Lazydoc::Document['ConstName']['key'].subject   # =&gt; 'value'
</pre>
<p>
By default a <a href="Attributes.html#M000013">lazy_attr</a> maps to the
constant attribute with the same name as the accessor, but this can be
overridden by specifying the string key for another attribute.
</p>
<pre>
  class ConstName
    lazy_attr :alt, 'key'
  end

  ConstName::alt.subject                     # =&gt; 'value'
  ConstName.const_attrs['alt']               # =&gt; nil
</pre>
<p>
Comments specified by non-string keys may also be stored in <a
href="Attributes.html#M000011">const_attrs</a>; these will not conflict
with constant attributes parsed from a source file. For instance you could
manually register a comment to a symbol key using <a
href="Attributes.html#M000014">lazy_register</a>:
</p>
<pre>
  class Sample
    extend Lazydoc::Attributes

    lazy_register(:method_one)

    # this is the method one comment
    def method_one
    end
  end

  Sample.const_attrs[:method_one].comment    # =&gt; &quot;this is the method one comment&quot;
</pre>
<p>
Manually-registered comments may then be paired with a <a
href="Attributes.html#M000013">lazy_attr</a>. As before the key for the
comment is provided in the definition.
</p>
<pre>
  class Paired
    extend Lazydoc::Attributes

    lazy_attr(:one, :method_one)
    lazy_register(:method_one)

    # this is the method one comment
    def method_one
    end
  end

  Paired::one.comment   # =&gt; &quot;this is the method one comment&quot;
</pre>
<h4>Troubleshooting</h4>
<p>
Under most circumstances <a href="Attributes.html">Attributes</a> will
register all the necessary files to make constant attributes available.
These include:
</p>
<ul>
<li>the file where the class is <a href="Attributes.html#M000009">extended</a>

</li>
<li>the file where a subclass inherits from an <a
href="Attributes.html#M000009">extended</a> class

</li>
<li>files that declare a <a href="Attributes.html#M000013">lazy_attr</a>

</li>
</ul>
<p>
Be sure to call <a href="Attributes.html#M000012">register_lazydoc</a> in
files that are not covered by one of these cases but nonetheless contain
constant attributes that should be available to a <a
href="Attributes.html#M000013">lazy_attr</a>.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000011">const_attrs</a>&nbsp;&nbsp;
      <a href="#M000009">extended</a>&nbsp;&nbsp;
      <a href="#M000013">lazy_attr</a>&nbsp;&nbsp;
      <a href="#M000014">lazy_register</a>&nbsp;&nbsp;
      <a href="#M000015">register___</a>&nbsp;&nbsp;
      <a href="#M000012">register_lazydoc</a>&nbsp;&nbsp;
      <a href="#M000010">registered_methods</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">lazy_registry</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
A hash of (method_name, [comment_class, caller_index]) pairs indicating
methods to lazily register, and the inputs used to register the method.

<p>
The lazy_registry only contains methods lazily registered within the
current class or module. To return methods registered throughout the
inheritance hierarchy, use <a
href="Attributes.html#M000010">registered_methods</a>(true)
</p>
</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">lazydocs</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
Returns the documents registered to the extending class.

<p>
By default lazydocs contains a <a href="Document.html">Document</a> for the
file where <a href="Attributes.html">Attributes</a> extends the class, or
where a subclass first inherits from an <a
href="Attributes.html#M000009">extended</a> class (if you include <a
href="Attributes.html">Attributes</a>, you must set lazydocs manually).
</p>
<p>
Additional documents may be added by calling <a
href="Attributes.html#M000012">register_lazydoc</a>.
</p>
</td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000009" class="method-detail">
        <a name="M000009"></a>

        <div class="method-heading">
          <a href="#M000009" class="method-signature">
          <span class="method-name">extended</span><span class="method-args">(base)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets source_file as the file where <a href="Attributes.html">Attributes</a>
first extends the class.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000009-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000009-source">
<pre>
     <span class="ruby-comment cmt"># File lib/lazydoc/attributes.rb, line 122</span>
122:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">extended</span>(<span class="ruby-identifier">base</span>)
123:       <span class="ruby-identifier">caller</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">=~</span> <span class="ruby-constant">CALLER_REGEXP</span>
124:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">base</span>.<span class="ruby-identifier">instance_variable_defined?</span>(<span class="ruby-identifier">:@lazydocs</span>)
125:         <span class="ruby-identifier">base</span>.<span class="ruby-identifier">instance_variable_set</span>(<span class="ruby-identifier">:@lazydocs</span>, [<span class="ruby-constant">Lazydoc</span>[<span class="ruby-identifier">$1</span>]])
126:       <span class="ruby-keyword kw">end</span>
127:       
128:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">base</span>.<span class="ruby-identifier">instance_variable_defined?</span>(<span class="ruby-identifier">:@lazy_registry</span>)
129:         <span class="ruby-identifier">base</span>.<span class="ruby-identifier">instance_variable_set</span>(<span class="ruby-identifier">:@lazy_registry</span>, {})
130:       <span class="ruby-keyword kw">end</span>
131:       
132:       <span class="ruby-keyword kw">super</span>
133:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000011" class="method-detail">
        <a name="M000011"></a>

        <div class="method-heading">
          <a href="#M000011" class="method-signature">
          <span class="method-name">const_attrs</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the constant attributes resolved for the <a
href="Attributes.html#M000009">extended</a> class.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000011-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000011-source">
<pre>
     <span class="ruby-comment cmt"># File lib/lazydoc/attributes.rb, line 160</span>
160:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">const_attrs</span>
161:       <span class="ruby-constant">Document</span>[<span class="ruby-identifier">to_s</span>]
162:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000010" class="method-detail">
        <a name="M000010"></a>

        <div class="method-heading">
          <a href="#M000010" class="method-signature">
          <span class="method-name">registered_methods</span><span class="method-args">(as_registry=false)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns an array of the methods whose documentation will be automatically
registered by <a href="Attributes.html">Attributes</a>. Set as_registry to
true to return a hash of of (method_name, [comment_class, caller_index])
pairs where the registration arguments are the hash values.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000010-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000010-source">
<pre>
     <span class="ruby-comment cmt"># File lib/lazydoc/attributes.rb, line 148</span>
148:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">registered_methods</span>(<span class="ruby-identifier">as_registry</span>=<span class="ruby-keyword kw">false</span>)
149:       <span class="ruby-identifier">methods</span> = {}
150:       <span class="ruby-identifier">ancestors</span>.<span class="ruby-identifier">reverse</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ancestor</span><span class="ruby-operator">|</span>
151:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ancestor</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Attributes</span>)
152:           <span class="ruby-identifier">methods</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">ancestor</span>.<span class="ruby-identifier">lazy_registry</span>)
153:         <span class="ruby-keyword kw">end</span>
154:       <span class="ruby-keyword kw">end</span>
155:       
156:       <span class="ruby-identifier">as_registry</span> <span class="ruby-value">? </span><span class="ruby-identifier">methods</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">methods</span>.<span class="ruby-identifier">keys</span>
157:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Protected Instance methods</h3>

      <div id="method-M000013" class="method-detail">
        <a name="M000013"></a>

        <div class="method-heading">
          <a href="#M000013" class="method-signature">
          <span class="method-name">lazy_attr</span><span class="method-args">(symbol, key=symbol.to_s, writable=true)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Creates a method that reads and resolves the constant attribute specified
by key. The method has a signature like:
</p>
<pre>
  def method(resolve=true)
  end
</pre>
<p>
To return the constant attribute without resolving, call the method with
resolve == false. If writable is true, a corresponding writer is also
created.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000013-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000013-source">
<pre>
     <span class="ruby-comment cmt"># File lib/lazydoc/attributes.rb, line 192</span>
192:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">lazy_attr</span>(<span class="ruby-identifier">symbol</span>, <span class="ruby-identifier">key</span>=<span class="ruby-identifier">symbol</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">writable</span>=<span class="ruby-keyword kw">true</span>)
193:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">String</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Symbol</span>)
194:         <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;invalid lazy_attr key: #{key.inspect} (#{key.class})&quot;</span>
195:       <span class="ruby-keyword kw">end</span>
196:       
197:       <span class="ruby-identifier">key</span> = <span class="ruby-identifier">key</span>.<span class="ruby-identifier">inspect</span>
198:       <span class="ruby-identifier">instance_eval</span> <span class="ruby-node">%Q{def #{symbol}(resolve=true); get_const_attr(#{key}, resolve); end}</span>
199:       <span class="ruby-identifier">instance_eval</span>(<span class="ruby-node">%Q{def #{symbol}=(comment); const_attrs[#{key}] = comment; end}</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">writable</span>
200:       
201:       <span class="ruby-identifier">register_lazydoc</span>(<span class="ruby-value">1</span>)
202:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000014" class="method-detail">
        <a name="M000014"></a>

        <div class="method-heading">
          <a href="#M000014" class="method-signature">
          <span class="method-name">lazy_register</span><span class="method-args">(method_name, comment_class=Method, caller_index=1)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Marks the method for lazy registration. When the method is registered, it
will be stored in <a href="Attributes.html#M000011">const_attrs</a> by
method_name.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000014-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000014-source">
<pre>
     <span class="ruby-comment cmt"># File lib/lazydoc/attributes.rb, line 206</span>
206:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">lazy_register</span>(<span class="ruby-identifier">method_name</span>, <span class="ruby-identifier">comment_class</span>=<span class="ruby-constant">Method</span>, <span class="ruby-identifier">caller_index</span>=<span class="ruby-value">1</span>)
207:       <span class="ruby-identifier">lazy_registry</span>[<span class="ruby-identifier">method_name</span>.<span class="ruby-identifier">to_sym</span>] = [<span class="ruby-identifier">comment_class</span>, <span class="ruby-identifier">caller_index</span>]
208:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000015" class="method-detail">
        <a name="M000015"></a>

        <div class="method-heading">
          <a href="#M000015" class="method-signature">
          <span class="method-name">register___</span><span class="method-args">(key, comment_class=Method)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Manually registers the next comment into <a
href="Attributes.html#M000011">const_attrs</a>. Note a <a
href="Attributes.html#M000013">lazy_attr</a> will still need to be defined
to access this comment as an attribute.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000015-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000015-source">
<pre>
     <span class="ruby-comment cmt"># File lib/lazydoc/attributes.rb, line 212</span>
212:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">register___</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">comment_class</span>=<span class="ruby-constant">Method</span>)
213:       <span class="ruby-identifier">caller</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">=~</span> <span class="ruby-constant">CALLER_REGEXP</span>
214:       <span class="ruby-identifier">source_file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">$1</span>)
215:       <span class="ruby-identifier">const_attrs</span>[<span class="ruby-identifier">key</span>] = <span class="ruby-constant">Lazydoc</span>[<span class="ruby-identifier">source_file</span>].<span class="ruby-identifier">register___</span>(<span class="ruby-identifier">comment_class</span>, <span class="ruby-value">1</span>)
216:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000012" class="method-detail">
        <a name="M000012"></a>

        <div class="method-heading">
          <a href="#M000012" class="method-signature">
          <span class="method-name">register_lazydoc</span><span class="method-args">(caller_index=0)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Registers the calling file into lazydocs. Registration occurs by examining
the call stack at the specified index.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000012-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000012-source">
<pre>
     <span class="ruby-comment cmt"># File lib/lazydoc/attributes.rb, line 176</span>
176:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">register_lazydoc</span>(<span class="ruby-identifier">caller_index</span>=<span class="ruby-value">0</span>)
177:       <span class="ruby-identifier">caller</span>[<span class="ruby-identifier">caller_index</span>] <span class="ruby-operator">=~</span> <span class="ruby-constant">CALLER_REGEXP</span>
178:       <span class="ruby-identifier">lazydocs</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Lazydoc</span>[<span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">$1</span>)]
179:       <span class="ruby-identifier">lazydocs</span>.<span class="ruby-identifier">uniq!</span>
180:       <span class="ruby-keyword kw">self</span>
181:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>