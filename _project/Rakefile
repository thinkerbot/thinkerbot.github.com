$:.unshift File.expand_path('../lib', __FILE__)
require 'thinkerbot/registry'

logger   = Logger.new($stdout)
logger.datetime_format = "%Y/%m/%d %H:%M:%S"

root_dir = File.expand_path('../..', __FILE__)
registry = Thinkerbot::Registry.setup(root_dir, logger)

#
# Project tasks
#

desc 'fetch gems for each project'
task :fetch do
  registry.chdir '_project/gems' do
    registry.each_version do |project, version|
      project.fetch(version)
    end
  end
end

desc 'unpack gems for each project'
task :unpack => :fetch do
  registry.chdir '_project/gems' do
    registry.each_version do |project, version|
      project.unpack(version)
    end
  end
end

desc 'build rdoc for each project'
task :rdoc => :unpack do
  registry.chdir '_project/gems' do
    registry.each_version do |project, version|
      project.build_rdoc(version)
    end
  end
end
