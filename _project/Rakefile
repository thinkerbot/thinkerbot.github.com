$:.unshift File.expand_path('../lib', __FILE__)
require 'thinkerbot/registry'

logger   = Logger.new($stdout)
logger.datetime_format = "%Y/%m/%d %H:%M:%S"

root_dir = File.expand_path('../..', __FILE__)
registry = Thinkerbot::Registry.setup(root_dir, logger)
force = ENV['FORCE'] == 'true'

#
# Project tasks
#

desc 'fetch gems for each project'
task :fetch do
  registry.chdir '_project/gems' do
    registry.each_release do |release|
      release.fetch(force)
    end
  end
end

desc 'unpack gems for each project'
task :unpack => :fetch do
  registry.chdir '_project/gems' do
    registry.each_release do |release|
      release.unpack(force)
    end
  end
end

desc 'build rdoc for each project'
task :rdoc => :unpack do
  registry.chdir '_project/gems' do
    registry.each_release do |release|
      release.build_rdoc(force)
    end
  end
end
